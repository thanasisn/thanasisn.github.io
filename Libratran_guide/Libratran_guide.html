<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Οδηγός χρήσης libRadtran.</title>
  <meta name="description" content="This a simple guide in the usage of the libRadtran model in greek." />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Οδηγός χρήσης libRadtran." />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This a simple guide in the usage of the libRadtran model in greek." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Οδηγός χρήσης libRadtran." />
  
  <meta name="twitter:description" content="This a simple guide in the usage of the libRadtran model in greek." />
  

<meta name="author" content="Thanasisn github.com/thanasisn" />


<meta name="date" content="2025-02-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">LibRadtran guide, LAP</a></li>

<li class="divider"></li>
<li><a href="#section"></a></li>
<li class="chapter" data-level="" data-path=""><a href="#δημιουργία-εκτελέσιμου-buildcompile-της-libradtran-2.0-σε-gnulinux."><i class="fa fa-check"></i>Δημιουργία εκτελέσιμου (build/compile) της Libradtran 2.0 σε GNU/Linux.</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#εγκατάσταση-βιβλιοθηκών-libraries-συστήματος."><i class="fa fa-check"></i>Εγκατάσταση βιβλιοθηκών (libraries) συστήματος.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#εγκατάσταση-του-uvspec-στο-σύστημα."><i class="fa fa-check"></i>Εγκατάσταση του <code>uvspec</code> στο σύστημα.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#εκτέλεση-του-uvspec."><i class="fa fa-check"></i>Εκτέλεση του <code>uvspec</code>.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#παράλληλη-εκτέλεση-του-uvspec-σε-bash-shell."><i class="fa fa-check"></i>Παράλληλη εκτέλεση του ‘uvspec’ σε Bash shell.</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#παραλληλοποίηση-με-τη-χρήση-της-εντολής-xargs."><i class="fa fa-check"></i>Παραλληλοποίηση με τη χρήση της εντολής <code>xargs</code>.</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#αρχείο-xargs_uvspec_worker.sh"><i class="fa fa-check"></i>Αρχείο <code>xargs_uvspec_worker.sh</code></a></li>
<li class="chapter" data-level="" data-path=""><a href="#αρχείο-xargs_parallel.sh"><i class="fa fa-check"></i>Αρχείο <code>xargs_parallel.sh</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#παραλληλοποίηση-με-τη-χρήση-sub-shells-στο-background-και-της-εντολής-wait."><i class="fa fa-check"></i>Παραλληλοποίηση με τη χρήση sub-shells στο background και της εντολής <code>wait</code>.</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#αρχείο-execute_in_subshells.sh"><i class="fa fa-check"></i>Αρχείο <code>execute_in_subshells.sh</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#παραλληλοποίηση-με-τη-χρήση-του-gnu-parallel."><i class="fa fa-check"></i>Παραλληλοποίηση με τη χρήση του <code>GNU parallel</code>.</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#παραμετροποίηση-cluster."><i class="fa fa-check"></i>Παραμετροποίηση cluster.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#παραμετροποίηση-του-parallel"><i class="fa fa-check"></i>Παραμετροποίηση του <code>parallel</code></a></li>
<li class="chapter" data-level="" data-path=""><a href="#χρήση-parallel"><i class="fa fa-check"></i>Χρήση <code>parallel</code></a></li>
<li class="chapter" data-level="" data-path=""><a href="#συγχρονισμόςμεταφορά-αρχείων."><i class="fa fa-check"></i>Συγχρονισμός/μεταφορά αρχείων.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#εκτέλεση-της-libradtran-σε-hpc-cluster."><i class="fa fa-check"></i>Εκτέλεση της libRadtran σε HPC cluster.</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#εισαγωγή"><i class="fa fa-check"></i>Εισαγωγή</a></li>
<li class="chapter" data-level="" data-path=""><a href="#ανάθεση-της-εκτέλεσης-στο-pbs-grid."><i class="fa fa-check"></i>Ανάθεση της εκτέλεσης στο PBS grid.</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#εκτέλεση-της-εντολής-uvspec-libradtran-ως-μία-εργασία-job."><i class="fa fa-check"></i>Εκτέλεση της εντολής uvspec (libRadtran) ως μία εργασία (job).</a></li>
<li class="chapter" data-level="" data-path=""><a href="#τροφοδοσία-παρτίδας-εργασιών-στο-grid."><i class="fa fa-check"></i>Τροφοδοσία παρτίδας εργασιών στο grid.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#εκτέλεση-μεγάλης-παρτίδας"><i class="fa fa-check"></i>Εκτέλεση μεγάλης παρτίδας</a></li>
<li class="chapter" data-level="" data-path=""><a href="#κοινές-εντολές-για-την-διαχείριση-των-παρτίδων-εργασιών."><i class="fa fa-check"></i>Κοινές εντολές για την διαχείριση των παρτίδων εργασιών.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#επεξεργασία-των-αποτελεσμάτων."><i class="fa fa-check"></i>Επεξεργασία των αποτελεσμάτων.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#δημιουργία-λίστα-παραμέτρων-προς-εκτέλεση."><i class="fa fa-check"></i>Δημιουργία λίστα παραμέτρων προς εκτέλεση.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#διαχείριση-αποτελεσμάτων."><i class="fa fa-check"></i>Διαχείριση αποτελεσμάτων.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#οδηγός-εγκατάστασης-της-libradtran-σε-περιβάλλον-windows."><i class="fa fa-check"></i>Οδηγός Εγκατάστασης της LibRadtran σε περιβάλλον Windows.</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#εγκατάσταση-του-λειτουργικού-περιβάλλοντος-cygwin."><i class="fa fa-check"></i>Εγκατάσταση του λειτουργικού περιβάλλοντος ‘Cygwin’.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#εγκατάσταση-της-libradtran."><i class="fa fa-check"></i>Εγκατάσταση της LibRadtran.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#χρήσιμες-πληροφορίες-για-τη-χρήση-της-libradtran."><i class="fa fa-check"></i>Χρήσιμες πληροφορίες για τη χρήση της libRadtran.</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#μονάδες-μέτρησης-ηλιακού-φάσματος."><i class="fa fa-check"></i>Μονάδες μέτρησης ηλιακού φάσματος.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#φασματικοί-υπολογισμοί-spectral-resolution."><i class="fa fa-check"></i>Φασματικοί υπολογισμοί (spectral resolution).</a></li>
<li class="chapter" data-level="" data-path=""><a href="#έξοδος-του-uvspec."><i class="fa fa-check"></i>Έξοδος του uvspec.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#τυπικά-ατμοσφαιρικά-προφίλ."><i class="fa fa-check"></i>Τυπικά ατμοσφαιρικά προφίλ.</a></li>
<li class="chapter" data-level="" data-path=""><a href="#προειδοποίηση-για-τη-γωνία-sza43.2circ."><i class="fa fa-check"></i>Προειδοποίηση για τη γωνία <span class="math inline">\({SZA}=43.2^\circ\)</span>.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#αναφορές"><i class="fa fa-check"></i>Αναφορές</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Οδηγός χρήσης libRadtran.</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Οδηγός χρήσης libRadtran.</h1>
<p class="author"><em>Thanasisn <a href="https://github.com/thanasisn">github.com/thanasisn</a></em></p>
<p class="date"><em>2025-02-07</em></p>
</div>

<div style="page-break-after: always;"></div>
<div id="section" class="section level1 unnumbered">
<h1 class="unnumbered"></h1>
<p> </p>
<p>Αρχείο <a href="https://thanasisn.github.io/Libratran_guide/Libratran_guide.pdf">pdf</a></p>
<p> 

 </p>
<p> </p>
<table>
<tbody>
<tr class="odd">
<td align="center">Η εργασία αυτή διανέμεται υπό την άδεια:</td>
</tr>
<tr class="even">
<td align="center">Creative Commons - Αναφορά Δημιουργού -</td>
</tr>
<tr class="odd">
<td align="center">Μη Εμπορική Χρήση - Παρόμοια Διανομή 4.0 Διεθνές.</td>
</tr>
<tr class="even">
<td align="center"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">http://creativecommons.org/licenses/by-nc-sa/4.0/</a></td>
</tr>
</tbody>
</table>
<p> 
 
 </p>
<table>
<tbody>
<tr class="odd">
<td align="center">Για διορθώσεις και προσθήκες επικοινωνήστε με Thanasisn <a href="https://github.com/thanasisn">github.com/thanasisn</a>.</td>
</tr>
</tbody>
</table>
<p> 
 
 </p>
<p><strong><em>Σημείωση:</em> Ο πηγαίος κώδικας (source code) που παρατίθεται εδώ είναι ένα παράδειγμα εφαρμογής κάποιων τεχνικών. Σε περίπτωση που θέλετε να τον χρησιμοποιήσετε, προτείνουμε να δοκιμαστεί η καταλληλότητα του για την επιθυμητή χρήση, πρώτα σε μη σημαντικές εφαρμογές (non-critical). Τα παραδείγματα κώδικα εδώ, διαφέρουν από αυτά που χρησιμοποιούμε, λόγω της συνεχής εξέλιξης και βελτίωσης κατά την χρήση τους.</strong></p>

<div style="page-break-after: always;"></div>
</div>
<div id="δημιουργία-εκτελέσιμου-buildcompile-της-libradtran-2.0-σε-gnulinux." class="section level1 hasAnchor">
<h1>Δημιουργία εκτελέσιμου (build/compile) της Libradtran 2.0 σε GNU/Linux.<a href="#δημιουργία-εκτελέσιμου-buildcompile-της-libradtran-2.0-σε-gnulinux." class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Το παράδειγμα αυτό έχει εφαρμοστεί σε λειτουργικό σύστημα Debian και βασίζεται στις οδηγίες που βρίσκονται στις ιστοσελίδες <a href="http://www.libradtran.org/doku.php?id=download">www.libradtran.org/doku.php?id=download</a> και <a href="http://www.libradtran.org/doc/INSTALL">www.libradtran.org/doc/INSTALL</a>.</p>
<div id="εγκατάσταση-βιβλιοθηκών-libraries-συστήματος." class="section level2 hasAnchor">
<h2>Εγκατάσταση βιβλιοθηκών (libraries) συστήματος.<a href="#εγκατάσταση-βιβλιοθηκών-libraries-συστήματος." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Εκτός από τα εργαλεία που περιγράφονται στις οδηγίες, είναι αναγκαίες και κάποιες άλλες βιβλιοθήκες για να μπορεί να γίνει compile του εκτελέσιμου uvspec. Η εγκατάστασή τους μπορεί να γίνει με την εντολή:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install libgsl0<span class="pp">*</span> netcdf-<span class="pp">*</span> libnetcdf<span class="pp">*</span></span></code></pre></div>
</div>
<div id="εγκατάσταση-του-uvspec-στο-σύστημα." class="section level2 hasAnchor">
<h2>Εγκατάσταση του <code>uvspec</code> στο σύστημα.<a href="#εγκατάσταση-του-uvspec-στο-σύστημα." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Το εκτελέσιμο που δημιουργήθηκε μπορεί να γίνει διαθέσιμο στο σύνολο του συστήματος βάζοντας ένα link της θέσης του στο φάκελο των αρχείων συστήματος.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ln <span class="at">-s</span> <span class="st">&#39;/path/to/libRadtran-2.0-64/bin/uvspec&#39;</span> <span class="st">&#39;/usr/bin/uvspec&#39;</span></span></code></pre></div>
<p>Το βήμα αυτό δεν είναι απαραίτητο, αλλά διευκολύνει την εκτέλεση του αρχείου από οποιοδήποτε σημείο του συστήματος χωρίς την ανάγκη να χρησιμοποιούμε ολόκληρη τη διαδρομή (full path) του αρχείου.</p>
</div>
<div id="εκτέλεση-του-uvspec." class="section level2 hasAnchor">
<h2>Εκτέλεση του <code>uvspec</code>.<a href="#εκτέλεση-του-uvspec." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Κατά την εκτέλεση του <code>uvspec</code>, το αρχείο χρειάζεται να διαβάσει μια σειρά από παραμετρικά αρχεία που βρίσκονται στον φάκελο της libRadtran. Η θέση των αρχείων αυτών μπορεί να δοθεί ως μία παράμετρος περιβάλλοντος (environmental variable). Αυτό γίνεται είτε ορίζοντάς την πριν την εκτέλεση, είτε βάζοντάς την στις ρυθμίσεις του shell του συστήματος.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LIBRADTRAN_DATA_FILES</span><span class="op">=</span><span class="st">&#39;/location/of/libRadtran-2.0-32/data/&#39;</span></span></code></pre></div>
<p>Κατά την εκτέλεση του <code>uvspec</code> είναι πρακτικό να χρησιμοποιούμε ένα κατάλληλα προετοιμασμένο αρχείο εισόδου (.inp) και να αποθηκεύουμε τα αποτελέσματα σε ένα αρχείο εξόδου (.out). Το πετυχαίνουμε αυτό κάνοντας χρήση της δυνατότητας ‘redirect’ της εισόδου (stdin “<code>&lt;</code>”) και εξόδου (stdout “<code>&gt;</code>”) του εκτελέσιμου.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uvspec</span> <span class="op">&lt;</span> <span class="st">&#39;/input/location/clear_atm.inp&#39;</span> <span class="op">&gt;</span> <span class="st">&#39;/ouput/location/clear_atm.out&#39;</span></span></code></pre></div>

<div style="page-break-after: always;"></div>
</div>
</div>
<div id="παράλληλη-εκτέλεση-του-uvspec-σε-bash-shell." class="section level1 hasAnchor">
<h1>Παράλληλη εκτέλεση του ‘uvspec’ σε Bash shell.<a href="#παράλληλη-εκτέλεση-του-uvspec-σε-bash-shell." class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Περισσότερα και πιο πρόσφατα αρχεία μπορούν να βρεθούν εδώ:
<a href="https://github.com/thanasisn/IStillBreakStuff/tree/main/libradtran">github.com/thanasisn/IStillBreakStuff/tree/main/libradtran</a></p>
<p>Οι παρακάτω μέθοδοι έχουν δοκιμαστεί σε περιβάλλον GNU/Linux και Windows (Cygwin). Θεωρούμε ότι η εκτέλεση γίνεται σε έναν υπολογιστή του οποίου θέλουμε να αξιοποιήσουμε όλους ή μερικούς από τους πυρήνες του επεξεργαστή του. Με κάποιες τροποποιήσεις και σχεδίαση, οι λύσεις αυτές μπορούν να εφαρμοστούν ταυτόχρονα και σε περισσότερους υπολογιστές, δε θα αναφερθούμε ιδιαίτερα σε αυτό διότι υπάρχουν εξειδικευμένα εργαλεία για αυτή την δουλειά, όπως:
<a href="https://www.gnu.org/software/parallel/">GNU parallel</a> (shell),
<a href="https://github.com/louwrentius/PPSS">PPSS</a> (shell),
<a href="https://research.cs.wisc.edu/htcondor/">HTCondor</a>,
<a href="http://dispy.sourceforge.net/">dispy</a> (python),
<a href="https://cran.r-project.org/web/packages/snow/index.html">snow</a> (R)
κ.λ.π.</p>
<p>Και στις δύο περιπτώσεις, πρέπει να υπάρχουν έτοιμα τα αρχεία εισόδου (.inp) της libRadtran. Ο τρόπος παραγωγής τους, δε θα μας απασχολήσει, καθώς μπορεί να γίνει με τα προτιμώμενα εργαλεία του χρήστη.</p>
<div id="παραλληλοποίηση-με-τη-χρήση-της-εντολής-xargs." class="section level2 hasAnchor">
<h2>Παραλληλοποίηση με τη χρήση της εντολής <code>xargs</code>.<a href="#παραλληλοποίηση-με-τη-χρήση-της-εντολής-xargs." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Σε αυτήν την περίπτωση χρησιμοποιούμε δύο Bash script, το πρώτο (xargs_uvspec_worker.sh) είναι υπεύθυνο για μία εκτέλεση του <code>uvspec</code> με τις κατάλληλες παραμέτρους (arguments). Το άλλο (xargs_parallel.sh), έχει την οργάνωση της παρτίδας εργασιών που θα εκτελεστούν από την εντολή <code>xargs</code>. Η εντολή <code>xargs</code> έχει την δυνατότητα να παρακολουθεί, μεταξύ άλλων, την χρήση των πυρήνων του επεξεργαστή, καθώς και να ελέγχει την εκτέλεση πολλαπλών εντολών.</p>
<div id="αρχείο-xargs_uvspec_worker.sh" class="section level3 hasAnchor">
<h3>Αρχείο <code>xargs_uvspec_worker.sh</code><a href="#αρχείο-xargs_uvspec_worker.sh" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p> </p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Worker to run one instance of uvspec, this is to be used by another script</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">## get arguments</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="va">OUTDIR</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${1}</span><span class="st">&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="va">ERRDIR</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${2}</span><span class="st">&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="va">total</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${3}</span><span class="st">&quot;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="va">Tic</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${4}</span><span class="st">&quot;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="va">INPUTF</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${5}</span><span class="st">&quot;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="va">cntt</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${6}</span><span class="st">&quot;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">## file to log this run</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="va">logfile</span><span class="op">=</span><span class="st">&quot;/path/to/a/log/file/JOB_</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%F&quot;</span><span class="va">)</span><span class="st">.log&quot;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">## set libradtran executable path</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="va">UVSPEC</span><span class="op">=</span><span class="st">&quot;/path/to/uvspec&quot;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">## check how many arguments</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$#</span> <span class="ot">-ne</span> 6 <span class="bu">]</span> <span class="kw">;</span> <span class="cf">then</span>  <span class="bu">echo</span> <span class="st">&quot; 6 arguments needed&quot;</span> <span class="kw">;</span>  <span class="bu">exit</span> 1 <span class="kw">;</span> <span class="cf">fi</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">## input base file name</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="va">fname</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">basename</span> <span class="va">$INPUTF)</span><span class="st">&quot;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">## out and error file names</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="va">OUTFIL</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${OUTDIR}</span><span class="st">/</span><span class="va">${fname</span><span class="op">%</span>.<span class="pp">*</span><span class="va">}</span><span class="st">.out&quot;</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="va">ERRFIL</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${ERRDIR}</span><span class="st">/</span><span class="va">${fname</span><span class="op">%</span>.<span class="pp">*</span><span class="va">}</span><span class="st">.err&quot;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">## print some info while running</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="va">TOT</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;scale=1; ((</span><span class="va">$cntt</span><span class="st">*100/</span><span class="va">$total</span><span class="st">))&quot;</span> <span class="kw">|</span> <span class="fu">bc</span><span class="va">)</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="va">ETA</span><span class="op">=</span><span class="va">$(($(($((total</span><span class="op">-</span><span class="va">cntt))</span><span class="op">*</span><span class="va">$(($(</span><span class="fu">date</span> +%s%N<span class="va">)</span><span class="op">-</span><span class="va">Tic))</span><span class="op">/</span><span class="dv">60000000000</span><span class="va">))</span><span class="op">/</span><span class="va">cntt))</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="bu">printf</span> <span class="st">&quot; %5s %5s/</span><span class="va">$total</span><span class="st"> %5s%%  ETA: %4s min\n&quot;</span> <span class="va">$((total</span><span class="op">-</span><span class="va">cntt))</span>  <span class="va">$cntt</span> <span class="va">$TOT</span> <span class="va">$ETA</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">## keep a log of what happened</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%F %T&quot;</span><span class="va">)</span><span class="st"> </span><span class="va">$fname</span><span class="st"> </span><span class="va">$cntt</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span> <span class="st">&quot;</span><span class="va">${logfile}</span><span class="st">&quot;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">#### HERE IS THE HEAVY LOAD ####</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">####TEST#### First try this to check what will run</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;(( &quot;</span><span class="va">${UVSPEC}</span><span class="st">&quot; &lt; &quot;</span><span class="va">${INPUTF}</span><span class="st">&quot;) | gzip &gt; &quot;</span><span class="va">${OUTFIL}</span>.gz<span class="st">&quot;) 2&gt; </span><span class="va">${ERRFIL}</span><span class="st">&quot;</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="fu">sleep</span> <span class="va">$((RANDOM</span><span class="op">%</span><span class="dv">5</span><span class="op">+</span><span class="dv">2</span><span class="va">))</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co">## Then use this to run the load</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co">#(( &quot;${UVSPEC}&quot; &lt; &quot;${INPUTF}&quot; ) | gzip &gt; &quot;${OUTFIL}.gz&quot; ) 2&gt; ${ERRFIL}</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span> 0</span></code></pre></div>
</div>
<div id="αρχείο-xargs_parallel.sh" class="section level3 hasAnchor">
<h3>Αρχείο <code>xargs_parallel.sh</code><a href="#αρχείο-xargs_parallel.sh" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p> </p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Executioner of uvspec worker, this is used to run multiple script instances</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">## EDIT all paths to full paths</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">## this will run a uvspec</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="va">WORKER_sh</span><span class="op">=</span><span class="st">&quot;./xargs_uvspec_worker.sh&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">## I/O folders</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="va">INPDIR</span><span class="op">=</span><span class="st">&quot;/path/to/files/for/INPUT/&quot;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="va">OUTDIR</span><span class="op">=</span><span class="st">&quot;/path/to/files/for/OUTPUT/&quot;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="va">ERRDIR</span><span class="op">=</span><span class="st">&quot;/path/to/files/for/error/&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">## Cores to use</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="va">cores</span><span class="op">=</span>8</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">####TEST#### DELETE THIS </span><span class="al">TEST</span><span class="co"> VARIABLE</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="va">INPDIR</span><span class="op">=</span><span class="st">&quot;/home/.../LibRadTranM/clear_H2O_LAP/DATA&quot;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">## initial files count</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="va">total</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">find</span> <span class="st">&quot;</span><span class="va">${INPDIR}</span><span class="st">&quot;</span> <span class="at">-type</span> f <span class="at">-iname</span> <span class="st">&quot;*.inp&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">## ask to continue</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span> <span class="kw">;</span> <span class="va">input</span><span class="op">=</span>0</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-n</span> <span class="st">&quot;Found </span><span class="va">$total</span><span class="st"> input files continue  (y/n)?: &quot;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="at">-n</span> 1 <span class="va">input</span> <span class="kw">;</span> <span class="bu">echo</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$input</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;y&quot;</span> <span class="er">-o</span> <span class="st">&quot;</span><span class="va">$input</span><span class="st">&quot;</span> == <span class="st">&quot;Y&quot;</span> ] <span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">printf</span> <span class="st">&quot;&quot;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;exit now..&quot;</span><span class="kw">;</span> <span class="bu">exit</span> 2</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">## set some variables</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="va">Tic</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">date</span> +%s%N<span class="va">)</span><span class="st">&quot;</span>    <span class="co">## keep time</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="va">Tac</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%F %T&quot;</span><span class="va">)</span><span class="st">&quot;</span> <span class="co">## keep time</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="va">cntt</span><span class="op">=</span>0</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co">#### THIS IS THE PARALLEL TRICK ####</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co">## run all input files through the WORKER_sh</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="fu">find</span> <span class="st">&quot;</span><span class="va">${INPDIR}</span><span class="st">&quot;</span> <span class="at">-type</span> f <span class="at">-iname</span> <span class="st">&quot;*.inp&quot;</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">line</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$line</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$((</span><span class="op">++</span><span class="va">cntt))</span><span class="st">&quot;</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span> <span class="kw">|</span> <span class="fu">xargs</span> <span class="at">-n</span> 2 <span class="at">-P</span> <span class="st">&quot;</span><span class="va">$cores</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$WORKER_sh</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">${OUTDIR}</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;</span><span class="va">${ERRDIR}</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$total</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$Tic</span><span class="st">&quot;</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co">## you are done, print end report</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="va">T</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(($(</span><span class="fu">date</span> +%s%N<span class="va">)</span><span class="op">-</span><span class="va">Tic))</span><span class="st">&quot;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="va">S</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$((T</span><span class="op">/</span><span class="dv">1000000000</span><span class="va">))</span><span class="st">&quot;</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="va">M</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$((T</span><span class="op">%</span><span class="dv">1000000000</span><span class="op">/</span><span class="dv">1000000</span><span class="va">))</span><span class="st">&quot;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;    ____UVSPEC_runs_finished____&quot;</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="bu">printf</span> <span class="st">&quot;DONE in:        %02d %02d:%02d:%02d.%03d &lt;\n&quot;</span> <span class="dt">\</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;</span><span class="va">$((S</span><span class="op">/</span><span class="dv">86400</span><span class="va">))</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$((S</span><span class="op">/</span><span class="dv">3600</span><span class="op">%</span><span class="dv">24</span><span class="va">))</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$((S</span><span class="op">/</span><span class="dv">60</span><span class="op">%</span><span class="dv">60</span><span class="va">))</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$((S</span><span class="op">%</span><span class="dv">60</span><span class="va">))</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">${M}</span><span class="st">&quot;</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;From  : </span><span class="va">$Tac</span><span class="st">&quot;</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Until : </span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%F %T&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span> 0</span></code></pre></div>
<p><em>Σημείωση:</em> Τα προηγούμενα πιθανότατα θα τρέξουν στον mistral.</p>
<p><strong>Προσοχή:</strong> <em>Ακόμα και αν σταματήσει το κύριο script, οι workers θα συνεχίσουν να τρέχουν, οπότε πρέπει να ξέρετε πως μπορεί να σταματήσει ένα script που τρέχει στο background!</em></p>
</div>
</div>
<div id="παραλληλοποίηση-με-τη-χρήση-sub-shells-στο-background-και-της-εντολής-wait." class="section level2 hasAnchor">
<h2>Παραλληλοποίηση με τη χρήση sub-shells στο background και της εντολής <code>wait</code>.<a href="#παραλληλοποίηση-με-τη-χρήση-sub-shells-στο-background-και-της-εντολής-wait." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Εδώ κάνουμε χρήση μιας απλής τεχνικής ελέγχου του αριθμού των <code>uvspec</code> που εκτελούνται από τον υπολογιστή. Η λογική που εφαρμόζουμε είναι, να μετρούμε τις εκτελέσεις που έχουν γίνει και να περιμένουμε να τελειώσει κάποια από αυτές πριν ξεκινήσουμε την επόμενη.</p>
<div id="αρχείο-execute_in_subshells.sh" class="section level3 hasAnchor">
<h3>Αρχείο <code>execute_in_subshells.sh</code><a href="#αρχείο-execute_in_subshells.sh" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p> </p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Simple parallel execution in bash</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Test it before use. This can not be stopped with &#39;ctr+C&#39;.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">## All processes are sent to the background.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">## libradtran executable</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="va">UVSPEC</span><span class="op">=</span><span class="st">&quot;/path/to/uvspec&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">## folders</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="va">INPDIR</span><span class="op">=</span><span class="st">&quot;/path/to/files/for/INPUT/&quot;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="va">OUTDIR</span><span class="op">=</span><span class="st">&quot;/path/to/files/for/OUTPUT/&quot;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="va">ERRDIR</span><span class="op">=</span><span class="st">&quot;/path/to/files/for/error/&quot;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="va">LBRDAT</span><span class="op">=</span><span class="st">&quot;/path/to/libradtran/data/folder/data&quot;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">## file to log this run</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="va">logfile</span><span class="op">=</span><span class="st">&quot;/path/to/a/log/file/JOB_</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%F_%T&quot;</span><span class="va">)</span><span class="st">.log&quot;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">## parameters</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="va">cores</span><span class="op">=</span>4     <span class="co">## cores to use</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="va">prs</span><span class="op">=</span>1       <span class="co">## counter of concurrent processes</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">## ensure folders exist</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">${OUTDIR}</span><span class="st">&quot;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">${ERRDIR}</span><span class="st">&quot;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">## export libradtran data files path this may be redundant</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LIBRADTRAN_DATA_FILES</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${LBRDAT}</span><span class="st">&quot;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">## count files</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="va">total</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">find</span> <span class="st">&quot;</span><span class="va">${INPDIR}</span><span class="st">&quot;</span> <span class="at">-type</span> f <span class="at">-iname</span> <span class="st">&quot;*.inp&quot;</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">## ask to continue</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span> <span class="kw">;</span> <span class="va">input</span><span class="op">=</span>0</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-n</span> <span class="st">&quot;Found </span><span class="va">$total</span><span class="st"> input files continue  (y/n)?: &quot;</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="at">-n</span> 1 <span class="va">input</span> <span class="kw">;</span> <span class="bu">echo</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$input</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;y&quot;</span> <span class="er">-o</span> <span class="st">&quot;</span><span class="va">$input</span><span class="st">&quot;</span> == <span class="st">&quot;Y&quot;</span> ] <span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">printf</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;exit now..&quot;</span><span class="kw">;</span> <span class="bu">exit</span> 1</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="va">cntt</span><span class="op">=</span>0                 <span class="co">## count total runs</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="kw">((</span><span class="va">cores</span><span class="op">--</span><span class="kw">))</span>            <span class="co">## start from zero</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="va">Tic</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">date</span> +%s%N<span class="va">)</span><span class="st">&quot;</span>    <span class="co">## keep time</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="va">Tac</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%F %T&quot;</span><span class="va">)</span><span class="st">&quot;</span> <span class="co">## keep time</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">## list all input files</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="fu">find</span> <span class="st">&quot;</span><span class="va">${INPDIR}</span><span class="st">&quot;</span> <span class="at">-type</span> f <span class="at">-iname</span> <span class="st">&quot;*.inp&quot;</span> <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">line</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">((</span><span class="va">cntt</span><span class="op">++</span><span class="kw">))</span>                        <span class="co">## increase count</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="va">fname</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">&quot;</span><span class="va">$line</span><span class="st">&quot;</span><span class="va">)</span>         <span class="co">## input  file-name</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="va">INPUT</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$line</span><span class="st">&quot;</span>                     <span class="co">## input  file-name full path</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="va">OUTPUT</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OUTDIR</span><span class="st">/</span><span class="va">${fname</span><span class="op">%</span>.<span class="pp">*</span><span class="va">}</span><span class="st">.OUT&quot;</span>  <span class="co">## output file-name full path</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="va">ERROR</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$ERRDIR</span><span class="st">/</span><span class="va">${fname</span><span class="op">%</span>.<span class="pp">*</span><span class="va">}</span><span class="st">.err&quot;</span>   <span class="co">## error  file-name full path</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">## print some info</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="va">TOT</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;scale=1; ((</span><span class="va">$cntt</span><span class="st">*100/</span><span class="va">$total</span><span class="st">))&quot;</span> <span class="kw">|</span> <span class="fu">bc</span><span class="va">)</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="va">ETA</span><span class="op">=</span><span class="va">$(($(($((total</span><span class="op">-</span><span class="va">cntt))</span><span class="op">*</span><span class="va">$(($(</span><span class="fu">date</span> +%s%N<span class="va">)</span><span class="op">-</span><span class="va">Tic))</span><span class="op">/</span><span class="dv">60000000000</span><span class="va">))</span><span class="op">/</span><span class="va">cntt))</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">printf</span> <span class="st">&quot; %5s %5s/</span><span class="va">$total</span><span class="st"> %5s%%  prs: %2s   ETA: %s min\n&quot;</span> <span class="dt">\</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>           <span class="va">$((total</span><span class="op">-</span><span class="va">cntt))</span>  <span class="va">$cntt</span> <span class="va">$TOT</span> <span class="va">$prs</span> <span class="va">$ETA</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">## keep a log of what happened</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%F %T&quot;</span><span class="va">)</span><span class="st"> </span><span class="va">$fname</span><span class="st"> </span><span class="va">$cntt</span><span class="st">&quot;</span> <span class="op">&gt;&gt;</span> <span class="st">&quot;</span><span class="va">${logfile}</span><span class="st">&quot;</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">#### uncomment to choose output with gzip compression</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ( ( ( &quot;${UVSPEC}&quot; &lt; &quot;${INPUT}&quot; ) | gzip &gt; &quot;${OUTPUT}.gz&quot; ) 2&gt; $ERROR ) &amp;</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">#### uncomment for output without compression</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ( ( ( &quot;${UVSPEC}&quot; &lt; &quot;${INPUT}&quot; )  &gt; &quot;${OUTPUT}&quot; ) 2&gt; $ERROR ) &amp;</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">#### uncomment for output without compression and</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">#### export libradtran data path this may be redundant</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ( ( ( export LIBRADTRAN_DATA_FILES=&quot;${LBRDAT}&quot;</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">#       &quot;${UVSPEC}&quot; &lt; &quot;${INPUT}&quot; )  &gt; &quot;${OUTPUT}&quot; ) 2&gt; $ERROR ) &amp;</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Throttle execution. This keeps script from running everything at once!</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">((</span> <span class="op">++</span><span class="va">prs</span> <span class="op">&gt;</span> <span class="va">cores</span> <span class="kw">));</span> <span class="cf">then</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>        <span class="bu">wait</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>        <span class="kw">((</span><span class="va">prs</span><span class="op">--</span><span class="kw">))</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="co">## wait for the last of the runs after the loop ends</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$(</span><span class="fu">seq</span> 1 <span class="va">$cores)</span><span class="kw">;</span> <span class="cf">do</span><span class="kw">;</span> <span class="bu">wait</span><span class="kw">;</span> <span class="cf">done</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="co">## print end report</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a><span class="va">T</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(($(</span><span class="fu">date</span> +%s%N<span class="va">)</span><span class="op">-</span><span class="va">Tic))</span><span class="st">&quot;</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="va">S</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$((T</span><span class="op">/</span><span class="dv">1000000000</span><span class="va">))</span><span class="st">&quot;</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="va">M</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$((T</span><span class="op">%</span><span class="dv">1000000000</span><span class="op">/</span><span class="dv">1000000</span><span class="va">))</span><span class="st">&quot;</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;    ____UVSPEC_runs_finished____&quot;</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a><span class="bu">printf</span> <span class="st">&quot;DONE in:        %02d %02d:%02d:%02d.%03d &lt;\n&quot;</span> <span class="dt">\</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;</span><span class="va">$((S</span><span class="op">/</span><span class="dv">86400</span><span class="va">))</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$((S</span><span class="op">/</span><span class="dv">3600</span><span class="op">%</span><span class="dv">24</span><span class="va">))</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$((S</span><span class="op">/</span><span class="dv">60</span><span class="op">%</span><span class="dv">60</span><span class="va">))</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$((S</span><span class="op">%</span><span class="dv">60</span><span class="va">))</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">${M}</span><span class="st">&quot;</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;From  : </span><span class="va">$Tac</span><span class="st">&quot;</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Until : </span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%F %T&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span> 0</span></code></pre></div>
<p><em>Σημείωση:</em> Αυτό πιθανότατα δε θα τρέξει στον mistral λόγω διαφορών στις εκδόσεις της <code>wait</code>. Δουλεύει σε διανομές Debian.</p>
<p><strong>Προσοχή:</strong> <em>Για να το σταματήσετε πρέπει να τερματίσετε όλες τις διεργασίες που γίνονται στο background και όχι μόνο αυτό το script (ctrl+C). Γι’ αυτό πρέπει να ξέρετε πώς τερματίζονται εργασίες στον background.</em></p>
<!-- Bash shell scripts to execute multiple uvspec (LibRadTran) instances. -->
<!-- Run LibRadTran on one host with xargs parallelization. -->
<!-- xargs_parallel_v2.sh (Mod: 2017-Mar-13 12:33:05) -->
<!-- xargs_uvspec_worker_v2.sh (Mod: 2017-Mar-13 12:50:28) -->
<!-- This is using the xargs command to run multiple worker scripts, each of which can run a uvspec instance. This will probably run on mistral. You can stop the main script, but the currently running workers will continue. -->
<!-- USAGE: Edit the file paths and the number of cores you want to use and un-comment some lines. -->
<!-- Run LibRadTran on one host with subshells and wait. -->
<!-- LBT_execute_in_subshells.sh (Mod: 2017-Mar-10 17:29:57) -->
<!-- This is using bash to run multiple instances of a shell with a uvspec running inside. It captures stout and sterr at separate files for each one. And can optional compress it. It assumes that you have prepared all the input files you want to run in a folder. -->
<!-- USAGE: Edit the file paths and the number of cores you want to use and un-comment some lines. -->
<!-- WARNING: To stop it you need to terminate all the background jobs and not just the script (ctrl+C). -->
<!-- NOTE: This will probably not run on mistral due to differences on the wait command. But it will run on other hosts. -->
<!-- LBT_execute_in_subshells_prety.sh (Mod: 2017-Mar-10 18:26:27) -->
<!-- Same as above but has some logging of the overall processes and a pretty output. (ETA, run/total, completion, etc.) -->
</div>
</div>
<div id="παραλληλοποίηση-με-τη-χρήση-του-gnu-parallel." class="section level2 hasAnchor">
<h2>Παραλληλοποίηση με τη χρήση του <code>GNU parallel</code>.<a href="#παραλληλοποίηση-με-τη-χρήση-του-gnu-parallel." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Με το <code>parallel</code> (<code>GNU parallel</code>) μπορούμε να χρησιμοποιήσουμε πολλαπλούς πυρήνες ενός υπολογιστή, αλλά και περισσότερους από έναν υπολογιστή (cluster). Το <code>parallel</code> είναι στην ουσία ένας διαχειριστής εκτελέσεων (job scheduler). Τα επόμενα παραδείγματα είναι ίσως η πιο απλοποιημένη παραμετροποίηση που μπορούμε να κάνουμε. Για πιο σύνθετες περιπτώσεις δείτε τα εγχειρίδια των προγραμμάτων.</p>
<div id="παραμετροποίηση-cluster." class="section level3 hasAnchor">
<h3>Παραμετροποίηση cluster.<a href="#παραμετροποίηση-cluster." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Για να έχει πρόσβαση το <code>parallel</code> στους υπόλοιπους υπολογιστές, χρειάζεται πρώτα να ρυθμίσουμε το <code>ssh</code> ώστε να μπορεί να βρει του υπόλοιπους υπολογιστές στο δίκτυο.</p>
<div id="configure-network." class="section level4 hasAnchor">
<h4>Configure network.<a href="#configure-network." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Οι υπολογιστές μπορεί να βρίσκονται στο τοπικό μας δίκτυο ή να έχουν σταθερή διεύθυνση IP, οπότε χρειάζεται ελάχιστη ρύθμιση. Είτε, να έχουμε ρυθμισμένο κάποιο VPN ώστε να μη χρειάζεται να μας απασχολεί η περίπτωση της μη σταθερής διεύθυνση IP ή της μετακίνησης του υπολογιστή σε άλλο δίκτυο (π.χ. laptop).</p>
</div>
<div id="configure-ssh." class="section level4 hasAnchor">
<h4>Configure ssh.<a href="#configure-ssh." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Πρέπει να έχουμε πρόσβαση σε κάθε υπολογιστή μέσω <code>ssh</code> και τη χρήση κλειδιού χωρίς την ανάγκη εισαγωγής κωδικού. Η διαδικασία ρύθμισης είναι εύκολο να βρεθεί στο internet ψάχνοντας π.χ. “passwordless authentication ssh keys”. Μετά από αυτό πρέπει να μπορείτε να έχετε πρόσβαση σε κάθε έναν από τους υπολογιστές εκτελώντας την εντολή π.χ. <code>ssh user@155.207.10.10 -i .ssh/libradtran_cl.pri</code> χωρίς να εισάγεται κωδικό. Όπου “155.207.10.10” είναι η θέση του υπολογιστή στο δίκτυο και “libradtran_cl.pri” το αρχείο του προσωπικού κλειδιού πρόσβασης (private key).</p>
<p>Για να οργανώσουμε το cluster χρειάζεται να συμπληρώσουμε ένα παραμετρικό αρχείο του ssh όπου θα αναφέρονται όλοι οι υπολογιστές που θέλουμε να χρησιμοποιήσουμε (default file <code>.ssh/config</code>). Αν όλα γίνουν σωστά θα μπορούμε να συνδεόμαστε μέσω <code>ssh</code> δίνοντας μόνο το όνομα του υπολογιστή π.χ. <code>ssh machine_1</code>. Αυτό, επίσης βοηθάει πολύ, στη γενικότερη αντιμετώπιση των προβλημάτων που μπορεί να προκύψουν, αλλά και στην παραμετροποίηση του κάθε υπολογιστή για την δουλειά που σκοπεύουμε να τρέξουμε.</p>
<div id="παράδειγμα-αρχείου-.sshconfig" class="section level6 hasAnchor">
<h6>Παράδειγμα αρχείου <code>.ssh/config</code><a href="#παράδειγμα-αρχείου-.sshconfig" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p> </p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Host</span> machine_1</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">HostName</span> 155.207.10.10</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">User</span> user</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">IdentityFile</span> ~/.ssh/machine1.pri</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Host</span> home_pc</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">HostName</span> 10.10.10.1</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">User</span> athan</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">IdentityFile</span> ~/.ssh/libradtran_cl.pri</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Host</span> laptop</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">HostName</span> 10.10.10.2</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">User</span> athan</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">IdentityFile</span> ~/.ssh/libradtran_cl.pri</span></code></pre></div>
</div>
</div>
</div>
<div id="παραμετροποίηση-του-parallel" class="section level3 hasAnchor">
<h3>Παραμετροποίηση του <code>parallel</code><a href="#παραμετροποίηση-του-parallel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Αφού ο κεντρικός υπολογιστής έχει πρόσβαση σε όλους του άλλους μέσω <code>ssh</code>, αρκεί ένα απλό παραμετρικό αρχείο για το <code>parallel</code>, με του υπολογιστές που θέλουμε να χρησιμοποιήσουμε στο cluster.</p>
<p>Στο παρακάτω αρχείο, δηλώνουμε ότι το cluster θα έχει τέσσερις υπολογιστές. Με το σύμβολο <code>:</code> είναι ο κεντρικός υπολογιστής, όπου οι πυρήνες του αναγνωρίζονται αυτόματα. Ο αριθμός πριν το όνομα του υπολογιστή δηλώνει τους πυρήνες του επεξεργαστή που θα είναι διαθέσιμοι από τον κάθε υπολογιστή.</p>
<div id="παράδειγμα-αρχείου-.parallelhosts" class="section level6 hasAnchor">
<h6>Παράδειγμα αρχείου <code>.parallel/hosts</code><a href="#παράδειγμα-αρχείου-.parallelhosts" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p> </p>
<pre eval="FALSE," size="scriptsize"><code>:
4/machine_1
2/home_pc
2/laptop</code></pre>
</div>
</div>
<div id="χρήση-parallel" class="section level3 hasAnchor">
<h3>Χρήση <code>parallel</code><a href="#χρήση-parallel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ένα παράδειγμα εκτέλεσης του <code>parallel</code>. Η χρήση των παραμέτρων αναλύεται στο manual της εντολής.
Εδώ χρησιμοποιούμε έναν πυρήνα από κάθε υπολογιστή του cluster, όπου θα τρέξουμε τις εντολές που βρίσκονται στο αρχείο <code>jobs.list</code>. Όπου το αρχείο <code>optimise_worker_v1.R</code> παίρνει δύο παραμέτρους που τις χρησιμοποιεί για να τρέξει ένα εύρος παραμέτρων από μία άλλη λίστα εργασιών. Έτσι έχουμε χωρίσει την συνολική εργασία σε εκτελέσεις 100 μικρότερων εργασιών που αναθέτουμε σε κάθε υπολογιστή του cluster.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">parallel</span>            <span class="dt">\</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">--jobs</span> 1        <span class="dt">\</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">--progress</span>      <span class="dt">\</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">--eta</span>           <span class="dt">\</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">--results</span>  /home/athan/Aerosols_O3/DATA/par.out                         <span class="dt">\</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">--joblog</span>   /home/athan/Aerosols_O3/Libradtran_modeling/par.resume.file  <span class="dt">\</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">--sshloginfile</span> ~/.parallel/hosts <span class="dt">\</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">-a</span> /home/athan/Aerosols_O3/Libradtran_modeling/jobs.list</span></code></pre></div>
<div id="αρχείο-jobs.list." class="section level6 hasAnchor">
<h6>Αρχείο <code>jobs.list</code>.<a href="#αρχείο-jobs.list." class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p> </p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 1 100</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 101 200</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 201 300</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 301 400</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 401 500</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 501 600</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 601 700</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 701 800</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 801 900</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/athan/Aerosols_O3/Libradtran_modeling/optimise_worker_v1.R</span> 901 1000</span></code></pre></div>
</div>
</div>
<div id="συγχρονισμόςμεταφορά-αρχείων." class="section level3 hasAnchor">
<h3>Συγχρονισμός/μεταφορά αρχείων.<a href="#συγχρονισμόςμεταφορά-αρχείων." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Ανάλογα με τη λογική της εφαρμογής της παραλληλοποίησης, είναι λιγότερο η περισσότερο απαραίτητο να μετακινούνται αρχεία μεταξύ των υπολογιστών. Αυτά τα αρχεία μπορεί να είναι αρχεία προς επεξεργασία, εκτελέσιμα ή αρχεία αποτελεσμάτων. Το <code>parallel</code> έχει κάποιες τέτοιες δυνατότητες, αλλά είναι ίσως πιο εύκολο να χρησιμοποιηθεί κάποια πιο εξειδικευμένη εφαρμογή. Δε θα αναλύσουμε την εφαρμογή τους αλλά θα δώσουμε κάποιες ιδέες.</p>
<p>unison:
Αμφίδρομα συγχρονίζει αρχεία μεταξύ υπολογιστών (όσα χρειάζονται), πολλές δυνατότητες παραμετροποίησης.</p>
<p>rsync:
Συγχρονίζει αρχεία μεταξύ υπολογιστών (όσα χρειάζονται), βελτιστοποιημένο στη μεταφορά αρχείων.</p>
<p>owncloud:
Cloud server απόθεσης αρχείων, μπορεί να εγκατασταθεί σε οποιονδήποτε υπολογιστή και οι υπόλοιποι να συγχρονίζονται από αυτόν.</p>
<p>nfs:
Δίσκος δικτύου, στον οποίο συνδέονται όλοι οι υπολογιστές και τον χρησιμοποιούν ως τοπικό.</p>
<p>Προφανώς, υπάρχουν και άλλοι τρόποι, και όποια επιλογή εξαρτάται από την διάρθρωση του δικτύου, τους διαθέσιμους πόρους και τον επιθυμητό στόχο.</p>

<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="εκτέλεση-της-libradtran-σε-hpc-cluster." class="section level1 hasAnchor">
<h1>Εκτέλεση της libRadtran σε HPC cluster.<a href="#εκτέλεση-της-libradtran-σε-hpc-cluster." class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="εισαγωγή" class="section level2 hasAnchor">
<h2>Εισαγωγή<a href="#εισαγωγή" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Εάν έχουμε την δυνατότητα, να χρησιμοποιήσουμε το HPC grid του πανεπιστημίου, μπορούμε να εκτελέσουμε πολύ μεγάλο όγκο προσομοιώσεων της ακτινοβολίας στην ατμόσφαιρα με την libRadtran, σε μικρό χρονικό διάστημα. Για τον σκοπό αυτό φτιάξαμε μερικά εργαλεία, τα οποία βοηθούν στη χρήση του συστήματος Portable Batch System (PBS/Torque) που ελέγχει την εκτέλεση και τον καταμερισμό των εργασιών στο grid.</p>
<p>Γενικά, θα αναφερόμαστε σε μία εκτέλεση του <code>uvspec</code> (εκτελέσιμο αρχείο της libRadtran) ως μία ανεξάρτητη ‘εργασία’ (job), αφού αυτή εξαρτάται μόνο από μία προκαθορισμένη ομάδα παραμέτρων. Αυτές οι ομάδες παραμέτρων αποτελούν μία λίστα πολλαπλών εργασιών τις οποίες αναθέτουμε στο PBS να εκτελέσει. Θα αναφερόμαστε σε αυτές ως παρτίδα εργασιών (batch job).</p>
<p>Μπορούμε να χωρίσουμε την όλη διαδικασία σε τρεις φάσεις.</p>
<ol style="list-style-type: decimal">
<li>Δημιουργία της λίστα παραμέτρων προς εκτέλεση.</li>
<li>Ανάθεση της εκτέλεσης στο PBS.</li>
<li>Επεξεργασία/διαχείριση των αποτελεσμάτων.</li>
</ol>
<p>Ανάλογα με τις ανάγκες, οι φάσεις αυτές επαναλαμβάνονται κυκλικά μέχρι να έχουμε τα επιθυμητά δεδομένα. Γι’ αυτό, είναι καλό να λάβουμε κάποια μέτρα κατά την προετοιμασία της ακολουθίας των φάσεων (workflow) ώστε να αποφύγουμε προβλήματα και να διευκολύνουμε την παραγωγή και διαχείριση των αποτελεσμάτων. Δε θα αναφερθούμε ιδιαίτερα σε αυτό, αλλά έχουμε φροντίσει ώστε να υπάρχει επαρκές logging και παρακολούθηση σε όλα τα στάδια της διαδικασίας ώστε να μπορούν να εντοπιστούν εύκολα τα προβλήματα και να διορθωθούν.</p>

</div>
<div id="ανάθεση-της-εκτέλεσης-στο-pbs-grid." class="section level2 hasAnchor">
<h2>Ανάθεση της εκτέλεσης στο PBS grid.<a href="#ανάθεση-της-εκτέλεσης-στο-pbs-grid." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="εκτέλεση-της-εντολής-uvspec-libradtran-ως-μία-εργασία-job." class="section level3 hasAnchor">
<h3>Εκτέλεση της εντολής uvspec (libRadtran) ως μία εργασία (job).<a href="#εκτέλεση-της-εντολής-uvspec-libradtran-ως-μία-εργασία-job." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Χρησιμοποιούμε ένα script (LBT_PBS.sh) σε Bash το οποίο αναλαμβάνει να καλέσει το εκτελέσιμο <code>uvspec</code> με τις παραμέτρους που του δίνει το σύστημα PBS. Αυτό το αρχείο θα εκτελεστεί σε κάθε πυρήνα, από τους διαθέσιμους και είναι υπεύθυνο για την ολοκλήρωση μίας προσομοίωσης ακτινοβολίας του μοντέλου.</p>
<p>Οι παράμετροι (arguments) που δέχεται αυτό το script είναι τέσσερις.</p>
<ol style="list-style-type: decimal">
<li><strong>Libradtran file path:</strong> ο φάκελος όπου βρίσκονται τα αρχεία της libRadtran.</li>
<li><strong>Libradtran output folder:</strong> ο φάκελος όπου θα αποθηκευτούν τα παραγόμενα αρχεία.</li>
<li><strong>unique id:</strong> μοναδικός δείκτης για να χρησιμοποιηθεί στο όνομα των αρχείων κάθε εργασίας.</li>
<li><strong>serialized string with uvspec options:</strong> μία λέξη με όλες τις παραμέτρους που χρειάζεται να ορίσουμε σε μία εκτέλεση του <code>uvspec</code>.</li>
</ol>
<p>Ο τρόπος που έχουμε επιλέξει για την αποστολή των παραμέτρων στο uvspec είναι η γραμμικοποίησή τους (serialization). Αυτό επιτρέπει την χρήση οποιοδήποτε κατάλληλων παραμέτρων της libRadtran χωρίς καμία τροποποίηση αυτού του αρχείου. Αυτό το πετυχαίνουμε, έχοντας κωδικοποιήσει την ερμηνεία του συμβόλου <code>@</code> ως νέα γραμμή και του <code>@@</code> ως τον χαρακτήρα του κενού. Με αυτόν τον τρόπο κάθε αρχείο εισόδου (.inp) μπορεί να σταλεί ως μία λέξη. Για παράδειγμα, η λέξη:</p>
<pre><code>atmosphere_file@@aattmmoo=afglms.dat@source@@solar@@ssoollaa=kurudz_1.0nm.
dat@mol_modify@@O3@@290@@DU@albedo@@0.05@sza@@26@altitude@@0.062694168@rte
_solver@@sdisort@number_of_streams@@6@wavelength@@250@@5025@pseudospherica
l@quiet@</code></pre>
<p>θα μετατραπεί στο αρχείο εισόδου (.inp):</p>
<pre><code>atmosphere_file /mnt/.../libRadtran-2.0.1/data/atmmod/afglms.dat
source solar /mnt/.../libRadtran-2.0.1/data/solar_flux/kurudz_1.0nm.dat
mol_modify O3 290 DU
albedo 0.05
sza 26
altitude 0.062694168
rte_solver sdisort
number_of_streams 6
wavelength 250 5025
pseudospherical
quiet
</code></pre>
<div id="αρχείο-lbt_pbs.sh." class="section level4 hasAnchor">
<h4>Αρχείο <code>LBT_PBS.sh</code>.<a href="#αρχείο-lbt_pbs.sh." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Στο πρώτο κομμάτι του script ελέγχουμε αν όλες οι παράμετροι έχουν δοθεί κανονικά από το PBS και προετοιμάζουμε τα ονόματα των αρχείων με την πλήρη τους διαδρομή στο δίσκο.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="va">libpath</span><span class="op">=</span><span class="va">$1</span>   <span class="co">## Libradtran file path .../libRadtran-2.0/</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="va">workdir</span><span class="op">=</span><span class="va">$2</span>   <span class="co">## Libradtran output folder for this model family</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="va">jobid</span><span class="op">=</span><span class="va">$3</span>     <span class="co">## unique id for this run</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="va">options</span><span class="op">=</span><span class="va">$4</span>   <span class="co">## serialized string  with uvspec options</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">## expand file paths</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="va">UVSPEC</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${libpath}</span><span class="st">/bin/uvspec&quot;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="va">DATA</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${libpath}</span><span class="st">/data&quot;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="va">WPTEMP</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${workdir}</span><span class="st">/clearwaterLAP&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">## have libRadtran path?</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$libpath</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;Empty variable &#39;libpath&#39;&quot;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exit</span> 2</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">## check executable location</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$UVSPEC</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;Can not find uvspec&quot;</span>                  <span class="kw">;</span> <span class="bu">exit</span> 3</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">## check data folder location</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-d</span> <span class="st">&quot;</span><span class="va">$DATA</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;Can not find data folder </span><span class="va">$DATA</span><span class="st">&quot;</span>       <span class="kw">;</span> <span class="bu">exit</span> 4</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">## have working dir path?</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$workdir</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;Empty variable &#39;workdir&#39;&quot;</span>             <span class="kw">;</span> <span class="bu">exit</span> 5</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">## check working folder location</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-d</span> <span class="st">&quot;</span><span class="va">$workdir</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;Can not find working folder </span><span class="va">$workdir</span><span class="st">&quot;</span> <span class="kw">;</span> <span class="bu">exit</span> 6</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">## have jobid?</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$jobid</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;Empty variable &#39;jobid&#39;&quot;</span>               <span class="kw">;</span> <span class="bu">exit</span> 7</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">## have libratran options?</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">$options</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;Empty variable &#39;options&#39;&quot;</span>             <span class="kw">;</span> <span class="bu">exit</span> 8</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co">## create working folder</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">${WPTEMP}</span><span class="st">&quot;</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co">## files for this job</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="va">INPUT</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${WPTEMP}</span><span class="st">/LBT_</span><span class="va">${jobid}</span><span class="st">.inp&quot;</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="va">OUPUT</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${WPTEMP}</span><span class="st">/LBT_</span><span class="va">${jobid}</span><span class="st">.out&quot;</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="va">ERPUT</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${WPTEMP}</span><span class="st">/LBT_</span><span class="va">${jobid}</span><span class="st">.err&quot;</span></span></code></pre></div>
<p>Στη συνέχεια μορφοποιούμε τις παραμέτρους της libRadtran σε ένα κατάλληλο αρχείο “.inp”.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">## create input file</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span> <span class="bu">echo</span> <span class="va">$options</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/@@/ /g&#39;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/@/\n/g&#39;</span> <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">line</span> <span class="kw">;</span><span class="cf">do</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="va">$line</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&quot;s@aattmmoo=@&quot;</span><span class="va">$DATA</span>/atmmod/<span class="st">&quot;@g&quot;</span>     <span class="dt">\</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>             <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&quot;s@ssoollaa=@&quot;</span><span class="va">$DATA</span>/solar_flux/<span class="st">&quot;@g&quot;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span> <span class="kw">)</span> <span class="op">&gt;</span> <span class="va">$INPUT</span></span></code></pre></div>
<p>Εκτελούμε το <code>uvspec</code> παραπέμποντας τα κατάλληλα αρχεία (εισόδου, εξόδου και σφαλμάτων) και όταν τελειώσει η εκτέλεσή του συμπιέζουμε το αρχείο εξόδου. Η συμπίεση βοηθάει στο να μειωθεί το μέγεθος των αρχείων αποτελεσμάτων αλλά και στη μεταφορά τους από τον υπολογιστή που έκανε την εκτέλεση, στον υπολογιστή ελέγχου.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#### ready to run uvspec</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="va">tic</span><span class="op">=</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%s&quot;</span><span class="va">)</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="va">loa</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">uptime</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-o</span> <span class="st">&quot;load .*&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LIBRADTRAN_DATA_FILES</span><span class="op">=</span><span class="va">${DATA}</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span> <span class="va">$UVSPEC</span> <span class="op">&lt;</span> <span class="va">$INPUT</span> <span class="op">&gt;</span> <span class="va">$OUPUT</span> <span class="kw">)</span> <span class="op">&gt;&amp;</span> <span class="va">$ERPUT</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="bu">wait</span><span class="kw">;</span> <span class="bu">wait</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">gzip</span> <span class="at">-f</span> <span class="va">$OUPUT</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="va">tac</span><span class="op">=</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%s&quot;</span><span class="va">)</span></span></code></pre></div>
<p>Αποθηκεύουμε κάποιες επιπρόσθετες πληροφορίες σχετικά με τον χρόνο εκτέλεσης και το σύστημα στο οποίο έγινε, ώστε να τις χρησιμοποιήσουμε σε περίπτωση σφαλμάτων.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">## helpful info for this run and uvspec error collector</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span> <span class="bu">echo</span> <span class="va">$loa</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uptime</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-o</span> <span class="st">&quot;load .*&quot;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">&quot;hostname=</span><span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">date</span> +<span class="st">&quot;%F %T&quot;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="va">$tic</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="va">$tac</span>                    <span class="kw">)</span>   <span class="op">&gt;&gt;</span> <span class="va">$ERPUT</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span> 0</span></code></pre></div>
</div>
</div>
<div id="τροφοδοσία-παρτίδας-εργασιών-στο-grid." class="section level3 hasAnchor">
<h3>Τροφοδοσία παρτίδας εργασιών στο grid.<a href="#τροφοδοσία-παρτίδας-εργασιών-στο-grid." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Για να αναθέσουμε μία παρτίδα εργασιών (batch job), χρησιμοποιούμε ένα παραμετρικό αρχείο (submit.pbs) το οποίο περιέχει και ορίζει τις παραμέτρους εκτέλεση της παρτίδας. Εδώ, καθορίζονται οι παράμετροι που ελέγχουν τον τρόπο εκτελεσης της λίστα εργασιών. Για παράδειγμα, το πώς θα γίνει η αναφορά κατά την εκτέλεση, η διαχείριση των λαθών (error handling) κλπ.</p>
<p>Το αρχείο αυτό έχει ταυτόχρονα την λειτουργία του παραμετρικού αρχείου για το PBS. Αλλά, και την λειτουργία Bash script που το εκτελεί το PBS προκειμένου να χρησιμοποιήσει το περιεχόμενό/αποτέλεσμα των εντολών του.</p>
<p>Το δείγμα αρχείου που παραθέτουμε μπορεί να χρησιμοποιηθεί, είτε για την μερική εκτέλεση/δοκιμή μιας παρτίδας εργασιών, ή για την πλήρη εκτέλεση μιας παρτίδας.</p>
<div id="αρχείο-submit.pbs." class="section level4 hasAnchor">
<h4>Αρχείο <code>submit.pbs</code>.<a href="#αρχείο-submit.pbs." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Οι σειρές που ξεκινούν με ‘#PBS’ αφορούν παραμέτρους (arguments) που χρησιμοποιούνται από την εντολή <code>qsub</code> του PBS. Περισσότερες λεπτομέρειες στο manual της εντολής (<code>man qsub</code>).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -N clearatm</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -j oe</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -q see</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -M at...ys@gmail.com</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -m abe</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -l nodes=1:ppn=1</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -o condorlog/run.log</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -t 1-10</span></span></code></pre></div>
<p>Οι μεταβλητές που ξεκινούν με <code>PBS_*</code> παίρνουν τιμή από το σύστημα PBS κατά την εκτέλεση των ανεξάρτητων εργασιών (jobs). Εδώ, ως εργασία νοείται η εκτέλεση του αρχείου <code>LBT_PBS.sh</code> με τις κατάλληλες παραμέτρους και φυσικά αυτό είναι που θα καλέσει τελικά το <code>uvspec</code>. Όλα τα υπόλοιπα καθορίζουν την ανάσυρση των παραμέτρων από την λίστα εργασιών και η καταγραφή της προόδου της παρτίδας σε αρχείο.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="va">jobhomedir</span><span class="op">=</span><span class="st">&quot;/mnt/.../LibRadTranM/clear_water_pressure_ozone_LAP_meas/&quot;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="va">joblogfile</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${jobhomedir}</span><span class="st">/condorlog/clearwatermeas_</span><span class="va">$(</span><span class="fu">date</span> +<span class="st">&quot;%F&quot;</span><span class="va">)</span><span class="st">.log&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$PBS_O_WORKDIR</span> <span class="op">&gt;&gt;</span> <span class="st">&quot;</span><span class="va">${joblogfile}</span><span class="st">&quot;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="st">&quot;</span><span class="va">$jobhomedir</span><span class="st">&quot;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">## parse arguments from file</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="va">args</span><span class="op">=</span><span class="kw">`</span><span class="fu">sed</span> <span class="at">-n</span> <span class="st">&quot;</span><span class="va">${PBS_ARRAYID}</span><span class="st"> p&quot;</span> jobs_args.list<span class="kw">`</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="va">arglist</span><span class="op">=</span><span class="va">($args)</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="va">arg1</span><span class="op">=</span><span class="st">&quot;/mnt/lapmg_a/.../libRadtran-2.0.1/&quot;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="va">arg2</span><span class="op">=</span><span class="st">&quot;/mnt/lapmg_a/.../LibRadTranM/clear_water_pressure_ozone_LAP_meas/&quot;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="va">arg3</span><span class="op">=</span><span class="va">${arglist</span><span class="op">[</span><span class="dv">0</span><span class="op">]</span><span class="va">}</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="va">arg4</span><span class="op">=</span><span class="va">${arglist</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span><span class="va">}</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span>   <span class="bu">echo</span> <span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span> <span class="va">$PBS_O_HOST</span>  <span class="va">$PBS_SERVER</span> <span class="va">$PBS_O_QUEUE</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="va">${PBS_O_WORKDIR}</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;JOBID =&quot;</span> <span class="va">${PBS_ARRAYID}</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;arg12&quot;</span> <span class="va">${arg1}</span> <span class="va">${arg2}</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;arg3=&quot;</span><span class="va">${arg3}</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;arg4=&quot;</span><span class="va">${arg4}</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~&quot;</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="kw">)</span>  <span class="op">&gt;&gt;</span>  <span class="st">&quot;</span><span class="va">${joblogfile}</span><span class="st">&quot;</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co">## this is a job run</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="ex">./LBT_PBS.sh</span> <span class="va">$arg1</span> <span class="va">$arg2</span> <span class="va">$arg3</span> <span class="va">$arg4</span></span></code></pre></div>
<p>Θεωρούμε ότι ο αναγνώστης, είτε είναι εξοικειωμένος με τη χρήση του Bash shell, είτε ότι μπορεί να αναζητήσει πληροφορίες για την χρήση και την ερμηνεία των παραπάνω εντολών στο διαδίκτυο.</p>
</div>
</div>
<div id="εκτέλεση-μεγάλης-παρτίδας" class="section level3 hasAnchor">
<h3>Εκτέλεση μεγάλης παρτίδας<a href="#εκτέλεση-μεγάλης-παρτίδας" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Προκειμένου να οργανώσουμε καλύτερα την κατάθεση (submission) κάποιας μεγάλης παρτίδας (1000+ jobs), και κατόπιν επικοινωνίας με τους διαχειριστές του grid. Για την καλύτερη εξυπηρέτηση των χρηστών του grid, γράψαμε ένα Bash script ώστε να κάνουμε την κατάθεση σε μικρότερα τμήματα και με κάποια χρονική απόσταση.</p>
<div id="αρχείο-multisub.sh" class="section level4 hasAnchor">
<h4>Αρχείο <code>multisub.sh</code><a href="#αρχείο-multisub.sh" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Οι μεταβλητές ‘step’ και ‘watt’ καθορίζουν αντίστοιχα το μέγεθος των πακέτων εργασιών και τον χρόνου μεταξύ κάθε τμήματος. Οι τιμές τους σχετίζονται με τον χρόνο εκτέλεσης της libRadtran και τους διαθέσιμους πυρήνες. Οι τιμές εδώ, είναι ενδεικτικές για “σχετικά βαριές” εκτελέσεις της libRadtran. Σημειώνουμε ότι εδώ ο χρόνος αναμονής μεταξύ των πακέτων αυξάνεται γραμμικά.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="va">subfile</span><span class="op">=</span><span class="st">&quot;clearatm_submit.pbs&quot;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="va">total</span><span class="op">=</span>4900</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="va">step</span><span class="op">=</span>150</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="va">watt</span><span class="op">=</span>40</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">## get total lines</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="va">total</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">cat</span> jobs_args.list <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$subfile</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Total: <span class="va">$total</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> step : <span class="va">$step</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> wait : <span class="va">$watt</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span> <span class="kw">;</span> <span class="va">input</span><span class="op">=</span>0</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-n</span> <span class="st">&quot;Submit  (y/n)?: &quot;</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span>  <span class="va">input</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$input</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;y&quot;</span> <span class="er">-o</span> <span class="st">&quot;</span><span class="va">$input</span><span class="st">&quot;</span> == <span class="st">&quot;Y&quot;</span> ] <span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;                  Bombs Away....&quot;</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;ABORT! ABORT! ABORT! ABORT!&quot;</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">exit</span> 0</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ii <span class="kw">in</span> <span class="va">$(</span><span class="fu">seq</span> 0 <span class="va">$((total</span> <span class="op">/</span> <span class="va">step</span> <span class="op">-</span> <span class="dv">1</span><span class="va">)))</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">date</span> <span class="at">-d</span><span class="st">&quot;+</span><span class="va">$((watt</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span><span class="st"> seconds&quot;</span> +<span class="st">&quot;next at:  %F %T &quot;</span><span class="kw">;</span> <span class="bu">echo</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sleep</span> <span class="va">$((watt</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;running: qsub -t </span><span class="va">$((step</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span><span class="st">-</span><span class="va">$((step</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="va">step))</span><span class="st"> </span><span class="va">${subfile}</span><span class="st">&quot;</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">qsub</span> <span class="at">-t</span> <span class="va">$((step</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span>-<span class="va">$((step</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="va">step))</span>  <span class="st">&quot;</span><span class="va">${subfile}</span><span class="st">&quot;</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="va">$((total</span> <span class="op">%</span> <span class="va">step</span> <span class="va">))</span> <span class="ot">-gt</span> 0 <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">date</span> <span class="at">-d</span><span class="st">&quot;+</span><span class="va">$((watt</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span><span class="st"> seconds&quot;</span> +<span class="st">&quot;next at:  %F %T &quot;</span><span class="kw">;</span> <span class="bu">echo</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sleep</span> <span class="va">$((watt</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;run: qsub -t </span><span class="va">$((step</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="va">step</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span><span class="st">-</span><span class="va">$((step</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="va">step</span><span class="op">+</span><span class="va">total</span><span class="op">%</span><span class="va">step))</span><span class="st"> </span><span class="va">${subfile}</span><span class="st">&quot;</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="ex">qsub</span> <span class="at">-t</span> <span class="va">$((step</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="va">step</span><span class="op">+</span><span class="dv">1</span><span class="va">))</span>-<span class="va">$((step</span><span class="op">*</span><span class="va">ii</span><span class="op">+</span><span class="va">step</span><span class="op">+</span><span class="va">total</span><span class="op">%</span><span class="va">step))</span> <span class="st">&quot;</span><span class="va">${subfile}</span><span class="st">&quot;</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot; * * *  submitting done  * * *&quot;</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span> 0</span></code></pre></div>
</div>
</div>
<div id="κοινές-εντολές-για-την-διαχείριση-των-παρτίδων-εργασιών." class="section level3 hasAnchor">
<h3>Κοινές εντολές για την διαχείριση των παρτίδων εργασιών.<a href="#κοινές-εντολές-για-την-διαχείριση-των-παρτίδων-εργασιών." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Εκτέλεση παρτίδας όπως καθορίζεται από τις παραμέτρους του αρχείου ‘submit.pbs’.
Η γραμμή ‘#PBS -t 1-10’ στο αρχείο λέει στο PBS να εκτελέσει τις εργασίες 1 έως 10.
Αυτός είναι ένας τρόπος για να δοκιμάζονται μεγαλύτερες παρτίδες εργασιών ως προς την ορθότητα των ρυθμίσεών τους, πριν αφεθούν να τρέξουν στο σύνολό τους.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qsub</span> submit.pbs</span></code></pre></div>
<p>Ενας τρόπος να μπουν 100 εργασίες στη σειρά αναμονής προς εκτέλεση (queue).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qsub</span> <span class="at">-t</span> 301-400 submit.pbs</span></code></pre></div>
<p>Λίστα με τις εργασίες στην ουρά (queue).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qstat</span> <span class="at">-t</span></span></code></pre></div>
<p>Λίστα με τις εργασίες που εκτελούνται.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qstat</span> <span class="at">-e</span></span></code></pre></div>
<p>Λίστα με τους υπολογιστές (nodes) όπου εκτελούνται οι εργασίες.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qstat</span> <span class="at">-n1</span></span></code></pre></div>
<p>Σταματάει όλες τις εργασίες της παρτίδας 4168020.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qdel</span> 4168020</span></code></pre></div>
<p>Σταμάτημα επιλεγμένων εργασιών της παρτίδας 4168020.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">qdel</span> 4168020[]</span></code></pre></div>
<p>Συνεχείς τρόποι παρακολούθησης των εργασιών σε εκτέλεση/ουρά.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">watch</span> <span class="at">-ν10</span> <span class="st">&#39; qstat -t | grep &quot; R &quot; | wc -l ; \</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="st">             qstat -t | grep &quot; Q &quot; | wc -l ; \</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="st">             qstat -t &#39;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">watch</span> <span class="st">&#39; qstat -t | grep &quot; R &quot; | wc -l ; \</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="st">        qstat -t | grep &quot; Q &quot; | wc -l ; \</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="st">        qstat -t | grep &quot; R &quot; &#39;</span></span></code></pre></div>
<p>Διαθέσιμοι πόροι χωρίς τους εκτός λειτουργίας κόμβους.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pbsnodes</span> <span class="at">-c</span></span></code></pre></div>
<p>Λίστα όλων των κόμβων.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pbsnodes</span> <span class="at">-l</span></span></code></pre></div>
<p>Περισότερες πληροφορίες για τις παραπάνω εντολές μπορούν να βρεθούν στις αντίστοιχες
σελίδες <code>man</code>ual (<code>man pbsnodes</code>, <code>man qstat</code>, <code>man qsub</code>) ή στο Παράρτημα (<code>pbsnodes</code>: <a href="#manpbsnodes"><strong>??</strong></a>,
<code>qstat</code>: <a href="#manqstat"><strong>??</strong></a>,
<code>qsub</code>: <a href="#manqsub"><strong>??</strong></a>).</p>

</div>
</div>
<div id="επεξεργασία-των-αποτελεσμάτων." class="section level2 hasAnchor">
<h2>Επεξεργασία των αποτελεσμάτων.<a href="#επεξεργασία-των-αποτελεσμάτων." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ο υπολογιστής από τον οποίο κάνουμε την ανάθεση των εργασιών έχει εγκατεστημένη την γλώσσα προγραμματισμού ‘R’. Θα την χρησιμοποιήσουμε για να συγκεντρώσουμε τα αποτελέσματα που μας ενδιαφέρουν.</p>
<p>Θα διαβάσουμε τα πρωτογενή δεδομένα από τα αρχεία που παράχθηκαν κατά την εκτέλεση της libRadtran και θα τα αποθηκεύσουμε σε ένα αρχείο δεδομένων της ‘R’. Με αυτόν τον τρόπο, αποφεύγουμε την μεταφορά μεγάλων ποσοτήτων δεδομένων, στις περιπτώσεις που μας ενδιαφέρουν μόνο κάποιες συγκεντρωτικές τιμές.</p>
<p>Παρακάτω παρατίθεται ένα παράδειγμα για το πώς μπορεί να επιτευχθεί αυτό. Δεν κρίνουμε σκόπιμο να αναλύσουμε τη λειτουργία του script διότι η διαδικασία αυτή μπορεί να γίνει με διαφορετικού τρόπους και χρησιμοποιώντας πολλές άλλες γλώσσες προγραμματισμού, ανάλογα με τις ανάγκες και τις δεξιότητες του χρήστη.</p>
<div id="αρχείο-parse_data.r." class="section level4 hasAnchor">
<h4>Αρχείο <code>parse_data.R</code>.<a href="#αρχείο-parse_data.r." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p> </p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env Rscript</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="do">#### Clear environment</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="do">#### ----------------------------------------------</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">closeAllConnections</span>()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> (<span class="fu">ls</span>()[<span class="fu">ls</span>() <span class="sc">!=</span> <span class="st">&quot;&quot;</span>]))</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">TZ =</span> <span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>tic <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="do">## folder for this model family</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="do">## setwd(&#39;/mnt/lapmg_a/.../LibRadTranM/lear_H2O_LAP&#39;)</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="do">## folder paths</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>jobsfolder <span class="ot">&lt;-</span> <span class="st">&quot;clearwaterLAPmeas/&quot;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>datafolder <span class="ot">&lt;-</span> <span class="st">&quot;DATA/&quot;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>archfolder <span class="ot">&lt;-</span> <span class="st">&quot;DATA/ARCHIVED/&quot;</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(datafolder) <span class="sc">&amp;</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.exists</span>(archfolder) <span class="sc">&amp;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.exists</span>(jobsfolder)) {</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Folders exists</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Can not see all Folders&quot;</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="do">## read libraries</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;../R_common/trapezUVSPEC.R&quot;</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="do">## data output</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>datafile <span class="ot">&lt;-</span> <span class="st">&quot;../clear_H2O_PR_O3_meas_LAP.Rds&quot;</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="do">## function to read inp files</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>input_parms <span class="ot">&lt;-</span> <span class="cf">function</span>(inputfile) {</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(inputfile))</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">&quot;Missinig file: &quot;</span>, inputfile))</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># read input file</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    fcon <span class="ot">&lt;-</span> <span class="fu">file</span>(inputfile)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    lines <span class="ot">&lt;-</span> <span class="fu">readLines</span>(fcon)</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">close</span>(fcon)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    atmosphere_file <span class="ot">&lt;-</span> <span class="fu">basename</span>(</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(<span class="st">&quot;atmosphere_file&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">2</span>]</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    atmosphere_file <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(atmosphere_file, <span class="st">&quot;.dat&quot;</span>, <span class="at">fixed =</span> T))[<span class="dv">1</span>]</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    source_solar <span class="ot">&lt;-</span> <span class="fu">basename</span>(</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(<span class="st">&quot;source solar&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">3</span>]</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    source_solar <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(source_solar, <span class="st">&quot;.dat&quot;</span>, <span class="at">fixed =</span> T))[<span class="dv">1</span>]</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>    mol_modify_O3 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(<span class="st">&quot;mol_modify O3&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">3</span>]</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>    albedo <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(<span class="st">&quot;albedo&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">2</span>]</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5</span></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>    sza <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(<span class="st">&quot;sza&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">2</span>]</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6</span></span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>    altitude <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(<span class="st">&quot;altitude&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">2</span>]</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 7</span></span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>    rte_solver <span class="ot">&lt;-</span> <span class="fu">unlist</span>(</span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a>        <span class="fu">strsplit</span>(</span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a>            <span class="fu">grep</span>(<span class="st">&quot;rte_solver&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot; +&quot;</span></span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>    )[<span class="dv">2</span>]</span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 8</span></span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>    number_of_streams <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(<span class="st">&quot;number_of_streams&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">2</span>]</span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 9</span></span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a>    wavelength <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(<span class="st">&quot;wavelength&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a>    wvlngth_min <span class="ot">&lt;-</span> wavelength[<span class="dv">1</span>]</span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>    wvlngth_max <span class="ot">&lt;-</span> wavelength[<span class="dv">2</span>]</span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 10</span></span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a>    pseudospherical <span class="ot">&lt;-</span> <span class="fu">any</span>(<span class="fu">grepl</span>(<span class="st">&quot;^ *pseudospherical&quot;</span>, lines))</span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 11</span></span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a>    mol_modify_H2O <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(</span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;mol_modify H2O +[.0-9]+ +MM&quot;</span>, lines,</span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a>                  <span class="at">value =</span> <span class="cn">TRUE</span></span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">3</span>]</span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 12</span></span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a>    pressure <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(</span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(</span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a>            <span class="fu">strsplit</span>(</span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a>                <span class="fu">grep</span>(<span class="st">&quot;pressure&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; +&quot;</span></span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb31-137"><a href="#cb31-137" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">2</span>]</span>
<span id="cb31-138"><a href="#cb31-138" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a>    aninput <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a>        <span class="at">atmosphere_file =</span> atmosphere_file, <span class="at">source_solar =</span> source_solar,</span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a>        <span class="at">mol_modify_O3 =</span> mol_modify_O3, <span class="at">mol_modify_H2O =</span> mol_modify_H2O,</span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a>        <span class="at">albedo =</span> albedo, <span class="at">sza =</span> sza, <span class="at">altitude =</span> altitude,</span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a>        <span class="at">pressure =</span> pressure, <span class="at">rte_solver =</span> rte_solver, <span class="at">number_of_streams =</span> number_of_streams,</span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a>        <span class="at">wvlngth_min =</span> wvlngth_min, <span class="at">wvlngth_max =</span> wvlngth_max</span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(aninput)</span>
<span id="cb31-147"><a href="#cb31-147" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-148"><a href="#cb31-148" aria-hidden="true" tabindex="-1"></a><span class="do">## function to get integral of .out collumns</span></span>
<span id="cb31-149"><a href="#cb31-149" aria-hidden="true" tabindex="-1"></a>output_read_trapz <span class="ot">&lt;-</span> <span class="cf">function</span>(outputfile) {</span>
<span id="cb31-150"><a href="#cb31-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(outputfile))</span>
<span id="cb31-151"><a href="#cb31-151" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">&quot;Missinig file: &quot;</span>, outputfile))</span>
<span id="cb31-152"><a href="#cb31-152" aria-hidden="true" tabindex="-1"></a>    <span class="do">## fmt: lambda edir edn eup uavgdir uavgdn uavgup</span></span>
<span id="cb31-153"><a href="#cb31-153" aria-hidden="true" tabindex="-1"></a>    tempdata <span class="ot">&lt;-</span> <span class="fu">read.table</span>(outputfile)</span>
<span id="cb31-154"><a href="#cb31-154" aria-hidden="true" tabindex="-1"></a>    get <span class="ot">&lt;-</span> <span class="fu">trapezUVSPEC</span>(tempdata)</span>
<span id="cb31-155"><a href="#cb31-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb31-156"><a href="#cb31-156" aria-hidden="true" tabindex="-1"></a>        <span class="at">edir =</span> get[<span class="dv">1</span>], <span class="at">edn =</span> get[<span class="dv">2</span>], <span class="at">eup =</span> get[<span class="dv">3</span>], <span class="at">eglo =</span> get[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb31-157"><a href="#cb31-157" aria-hidden="true" tabindex="-1"></a>            get[<span class="dv">2</span>]</span>
<span id="cb31-158"><a href="#cb31-158" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-159"><a href="#cb31-159" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-160"><a href="#cb31-160" aria-hidden="true" tabindex="-1"></a><span class="do">## function to read .err files</span></span>
<span id="cb31-161"><a href="#cb31-161" aria-hidden="true" tabindex="-1"></a>error_param <span class="ot">&lt;-</span> <span class="cf">function</span>(errfile) {</span>
<span id="cb31-162"><a href="#cb31-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(errfile))</span>
<span id="cb31-163"><a href="#cb31-163" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">&quot;Missinig file: &quot;</span>, errfile))</span>
<span id="cb31-164"><a href="#cb31-164" aria-hidden="true" tabindex="-1"></a>    <span class="co"># read input file</span></span>
<span id="cb31-165"><a href="#cb31-165" aria-hidden="true" tabindex="-1"></a>    fcon <span class="ot">&lt;-</span> <span class="fu">file</span>(errfile)</span>
<span id="cb31-166"><a href="#cb31-166" aria-hidden="true" tabindex="-1"></a>    lines <span class="ot">&lt;-</span> <span class="fu">readLines</span>(fcon)</span>
<span id="cb31-167"><a href="#cb31-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">close</span>(fcon)</span>
<span id="cb31-168"><a href="#cb31-168" aria-hidden="true" tabindex="-1"></a>    <span class="do">## start end</span></span>
<span id="cb31-169"><a href="#cb31-169" aria-hidden="true" tabindex="-1"></a>    minD <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">as.numeric</span>(<span class="fu">grep</span>(<span class="st">&quot;^[0-9]+$&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb31-170"><a href="#cb31-170" aria-hidden="true" tabindex="-1"></a>    maxD <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">grep</span>(<span class="st">&quot;^[0-9]+$&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb31-171"><a href="#cb31-171" aria-hidden="true" tabindex="-1"></a>    hosts <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;hostname=.*&quot;</span>, lines, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-172"><a href="#cb31-172" aria-hidden="true" tabindex="-1"></a>    hosts <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(hosts, <span class="st">&quot;=&quot;</span>))[<span class="dv">2</span>]</span>
<span id="cb31-173"><a href="#cb31-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (hosts <span class="sc">!=</span> <span class="st">&quot;&quot;</span>) {</span>
<span id="cb31-174"><a href="#cb31-174" aria-hidden="true" tabindex="-1"></a>        host <span class="ot">&lt;-</span> hosts</span>
<span id="cb31-175"><a href="#cb31-175" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb31-176"><a href="#cb31-176" aria-hidden="true" tabindex="-1"></a>        host <span class="ot">&lt;-</span> <span class="st">&quot;unknown&quot;</span></span>
<span id="cb31-177"><a href="#cb31-177" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-178"><a href="#cb31-178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb31-179"><a href="#cb31-179" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="at">hostname =</span> host, <span class="at">ticTime =</span> minD, <span class="at">tacTime =</span> maxD)</span>
<span id="cb31-180"><a href="#cb31-180" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-181"><a href="#cb31-181" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-182"><a href="#cb31-182" aria-hidden="true" tabindex="-1"></a><span class="do">#### Parsing starts here ##### read saved data or fail</span></span>
<span id="cb31-183"><a href="#cb31-183" aria-hidden="true" tabindex="-1"></a>saved_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(datafile)</span>
<span id="cb31-184"><a href="#cb31-184" aria-hidden="true" tabindex="-1"></a><span class="co"># saved_data &lt;- data.frame() # if there is no previous</span></span>
<span id="cb31-185"><a href="#cb31-185" aria-hidden="true" tabindex="-1"></a><span class="co"># file read list of inp files inpfiles =</span></span>
<span id="cb31-186"><a href="#cb31-186" aria-hidden="true" tabindex="-1"></a><span class="co"># list.files(path = datafolder,</span></span>
<span id="cb31-187"><a href="#cb31-187" aria-hidden="true" tabindex="-1"></a>inpfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb31-188"><a href="#cb31-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> jobsfolder, <span class="at">pattern =</span> <span class="st">&quot;LBT_.*.inp&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-189"><a href="#cb31-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">recursive =</span> <span class="cn">FALSE</span></span>
<span id="cb31-190"><a href="#cb31-190" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-191"><a href="#cb31-191" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(inpfiles) <span class="sc">&lt;</span></span>
<span id="cb31-192"><a href="#cb31-192" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>) <span class="fu">stop</span>(<span class="st">&quot;No input files found&quot;</span>)</span>
<span id="cb31-193"><a href="#cb31-193" aria-hidden="true" tabindex="-1"></a><span class="do">## check if all files matching</span></span>
<span id="cb31-194"><a href="#cb31-194" aria-hidden="true" tabindex="-1"></a>pause <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb31-195"><a href="#cb31-195" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> inpfiles) {</span>
<span id="cb31-196"><a href="#cb31-196" aria-hidden="true" tabindex="-1"></a>    outputfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb31-197"><a href="#cb31-197" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(<span class="fu">strsplit</span>(ii, <span class="at">split =</span> <span class="st">&quot;.inp&quot;</span>))[<span class="dv">1</span>],</span>
<span id="cb31-198"><a href="#cb31-198" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;.out.gz&quot;</span></span>
<span id="cb31-199"><a href="#cb31-199" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-200"><a href="#cb31-200" aria-hidden="true" tabindex="-1"></a>    errfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb31-201"><a href="#cb31-201" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(<span class="fu">strsplit</span>(ii, <span class="at">split =</span> <span class="st">&quot;.inp&quot;</span>))[<span class="dv">1</span>],</span>
<span id="cb31-202"><a href="#cb31-202" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;.err&quot;</span></span>
<span id="cb31-203"><a href="#cb31-203" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-204"><a href="#cb31-204" aria-hidden="true" tabindex="-1"></a>    <span class="do">## check output files</span></span>
<span id="cb31-205"><a href="#cb31-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(outputfile)) {</span>
<span id="cb31-206"><a href="#cb31-206" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(</span>
<span id="cb31-207"><a href="#cb31-207" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;Missing file&quot;</span>, outputfile),</span>
<span id="cb31-208"><a href="#cb31-208" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb31-209"><a href="#cb31-209" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-210"><a href="#cb31-210" aria-hidden="true" tabindex="-1"></a>        pause <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb31-211"><a href="#cb31-211" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-212"><a href="#cb31-212" aria-hidden="true" tabindex="-1"></a>    <span class="do">## check error files</span></span>
<span id="cb31-213"><a href="#cb31-213" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(errfile)) {</span>
<span id="cb31-214"><a href="#cb31-214" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(</span>
<span id="cb31-215"><a href="#cb31-215" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;Missing file&quot;</span>, errfile),</span>
<span id="cb31-216"><a href="#cb31-216" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb31-217"><a href="#cb31-217" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-218"><a href="#cb31-218" aria-hidden="true" tabindex="-1"></a>        pause <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb31-219"><a href="#cb31-219" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-220"><a href="#cb31-220" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-221"><a href="#cb31-221" aria-hidden="true" tabindex="-1"></a>outfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb31-222"><a href="#cb31-222" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> jobsfolder, <span class="at">pattern =</span> <span class="st">&quot;LBT_.*.out.gz&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-223"><a href="#cb31-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">recursive =</span> <span class="cn">FALSE</span></span>
<span id="cb31-224"><a href="#cb31-224" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-225"><a href="#cb31-225" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> outfiles) {</span>
<span id="cb31-226"><a href="#cb31-226" aria-hidden="true" tabindex="-1"></a>    inpurfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb31-227"><a href="#cb31-227" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(<span class="fu">strsplit</span>(ii, <span class="at">split =</span> <span class="st">&quot;.out.gz&quot;</span>))[<span class="dv">1</span>],</span>
<span id="cb31-228"><a href="#cb31-228" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;.inp&quot;</span></span>
<span id="cb31-229"><a href="#cb31-229" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-230"><a href="#cb31-230" aria-hidden="true" tabindex="-1"></a>    <span class="do">## check input files</span></span>
<span id="cb31-231"><a href="#cb31-231" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(inpurfile)) {</span>
<span id="cb31-232"><a href="#cb31-232" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(</span>
<span id="cb31-233"><a href="#cb31-233" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">&quot;Missing file&quot;</span>, inpurfile),</span>
<span id="cb31-234"><a href="#cb31-234" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb31-235"><a href="#cb31-235" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-236"><a href="#cb31-236" aria-hidden="true" tabindex="-1"></a>        pause <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb31-237"><a href="#cb31-237" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-238"><a href="#cb31-238" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-239"><a href="#cb31-239" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (pause) {</span>
<span id="cb31-240"><a href="#cb31-240" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Pause to manual clean files&quot;</span>)</span>
<span id="cb31-241"><a href="#cb31-241" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-242"><a href="#cb31-242" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(</span>
<span id="cb31-243"><a href="#cb31-243" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(</span>
<span id="cb31-244"><a href="#cb31-244" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(inpfiles),</span>
<span id="cb31-245"><a href="#cb31-245" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot; files to read</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb31-246"><a href="#cb31-246" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-247"><a href="#cb31-247" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-248"><a href="#cb31-248" aria-hidden="true" tabindex="-1"></a><span class="do">## read data to a data frame</span></span>
<span id="cb31-249"><a href="#cb31-249" aria-hidden="true" tabindex="-1"></a>gather <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb31-250"><a href="#cb31-250" aria-hidden="true" tabindex="-1"></a>ccc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb31-251"><a href="#cb31-251" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> inpfiles) {</span>
<span id="cb31-252"><a href="#cb31-252" aria-hidden="true" tabindex="-1"></a>    ccc <span class="ot">&lt;-</span> ccc <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb31-253"><a href="#cb31-253" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(</span>
<span id="cb31-254"><a href="#cb31-254" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(</span>
<span id="cb31-255"><a href="#cb31-255" aria-hidden="true" tabindex="-1"></a>            ccc, <span class="st">&quot;/&quot;</span>, <span class="fu">length</span>(inpfiles),</span>
<span id="cb31-256"><a href="#cb31-256" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot; processed</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb31-257"><a href="#cb31-257" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-258"><a href="#cb31-258" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-259"><a href="#cb31-259" aria-hidden="true" tabindex="-1"></a>    outputfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb31-260"><a href="#cb31-260" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(<span class="fu">strsplit</span>(ii, <span class="at">split =</span> <span class="st">&quot;.inp&quot;</span>))[<span class="dv">1</span>],</span>
<span id="cb31-261"><a href="#cb31-261" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;.out.gz&quot;</span></span>
<span id="cb31-262"><a href="#cb31-262" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-263"><a href="#cb31-263" aria-hidden="true" tabindex="-1"></a>    errfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb31-264"><a href="#cb31-264" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>(<span class="fu">strsplit</span>(ii, <span class="at">split =</span> <span class="st">&quot;.inp&quot;</span>))[<span class="dv">1</span>],</span>
<span id="cb31-265"><a href="#cb31-265" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;.err&quot;</span></span>
<span id="cb31-266"><a href="#cb31-266" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-267"><a href="#cb31-267" aria-hidden="true" tabindex="-1"></a>    record <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb31-268"><a href="#cb31-268" aria-hidden="true" tabindex="-1"></a>        <span class="fu">input_parms</span>(ii),</span>
<span id="cb31-269"><a href="#cb31-269" aria-hidden="true" tabindex="-1"></a>        <span class="fu">output_read_trapz</span>(outputfile),</span>
<span id="cb31-270"><a href="#cb31-270" aria-hidden="true" tabindex="-1"></a>        <span class="fu">error_param</span>(errfile)</span>
<span id="cb31-271"><a href="#cb31-271" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-272"><a href="#cb31-272" aria-hidden="true" tabindex="-1"></a>    gather <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gather, record)</span>
<span id="cb31-273"><a href="#cb31-273" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-274"><a href="#cb31-274" aria-hidden="true" tabindex="-1"></a>colall <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-275"><a href="#cb31-275" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;atmosphere_file&quot;</span>, <span class="st">&quot;source_solar&quot;</span>, <span class="st">&quot;mol_modify_O3&quot;</span>,</span>
<span id="cb31-276"><a href="#cb31-276" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;albedo&quot;</span>, <span class="st">&quot;sza&quot;</span>, <span class="st">&quot;altitude&quot;</span>, <span class="st">&quot;rte_solver&quot;</span>, <span class="st">&quot;number_of_streams&quot;</span>,</span>
<span id="cb31-277"><a href="#cb31-277" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;wvlngth_min&quot;</span>, <span class="st">&quot;wvlngth_max&quot;</span>, <span class="st">&quot;edir&quot;</span>, <span class="st">&quot;eglo&quot;</span>, <span class="st">&quot;edn&quot;</span>,</span>
<span id="cb31-278"><a href="#cb31-278" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;eup&quot;</span>, <span class="st">&quot;mol_modify_H2O&quot;</span>, <span class="st">&quot;pressure&quot;</span></span>
<span id="cb31-279"><a href="#cb31-279" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-280"><a href="#cb31-280" aria-hidden="true" tabindex="-1"></a>colinp <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-281"><a href="#cb31-281" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;atmosphere_file&quot;</span>, <span class="st">&quot;source_solar&quot;</span>, <span class="st">&quot;mol_modify_O3&quot;</span>,</span>
<span id="cb31-282"><a href="#cb31-282" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;albedo&quot;</span>, <span class="st">&quot;sza&quot;</span>, <span class="st">&quot;altitude&quot;</span>, <span class="st">&quot;rte_solver&quot;</span>, <span class="st">&quot;number_of_streams&quot;</span>,</span>
<span id="cb31-283"><a href="#cb31-283" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;wvlngth_min&quot;</span>, <span class="st">&quot;wvlngth_max&quot;</span>, <span class="st">&quot;mol_modify_H2O&quot;</span>, <span class="st">&quot;pressure&quot;</span></span>
<span id="cb31-284"><a href="#cb31-284" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-285"><a href="#cb31-285" aria-hidden="true" tabindex="-1"></a><span class="do">## combine old and new data</span></span>
<span id="cb31-286"><a href="#cb31-286" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(saved_data, gather)</span>
<span id="cb31-287"><a href="#cb31-287" aria-hidden="true" tabindex="-1"></a><span class="do">## keep unique input combination</span></span>
<span id="cb31-288"><a href="#cb31-288" aria-hidden="true" tabindex="-1"></a>uniqueinqx <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">duplicated</span>(combined_data[, colinp])</span>
<span id="cb31-289"><a href="#cb31-289" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data[uniqueinqx, ]</span>
<span id="cb31-290"><a href="#cb31-290" aria-hidden="true" tabindex="-1"></a><span class="do">## check different results for same input</span></span>
<span id="cb31-291"><a href="#cb31-291" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">duplicated</span>(combined_data[, colall]))) {</span>
<span id="cb31-292"><a href="#cb31-292" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Posible different results for the same input&quot;</span>)</span>
<span id="cb31-293"><a href="#cb31-293" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-294"><a href="#cb31-294" aria-hidden="true" tabindex="-1"></a><span class="co"># ## this will remove stored data!!  saved_data =</span></span>
<span id="cb31-295"><a href="#cb31-295" aria-hidden="true" tabindex="-1"></a><span class="co"># saved_data[ saved_data$sza&lt;50, ] saveRDS(</span></span>
<span id="cb31-296"><a href="#cb31-296" aria-hidden="true" tabindex="-1"></a><span class="co"># saved_data, file = datafile, compress = &#39;xz&#39;) save</span></span>
<span id="cb31-297"><a href="#cb31-297" aria-hidden="true" tabindex="-1"></a><span class="co"># this set of data as local repository combined_data</span></span>
<span id="cb31-298"><a href="#cb31-298" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;- data.frame() ## used to reset stored data</span></span>
<span id="cb31-299"><a href="#cb31-299" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(combined_data, <span class="at">file =</span> datafile, <span class="at">compress =</span> <span class="st">&quot;xz&quot;</span>)</span>
<span id="cb31-300"><a href="#cb31-300" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot; now you can move files to ARCHIVED &quot;</span>)</span>
<span id="cb31-301"><a href="#cb31-301" aria-hidden="true" tabindex="-1"></a><span class="co"># print(apply(combined_data[,c(1:10,17)], 2, unique))</span></span>
<span id="cb31-302"><a href="#cb31-302" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(combined_data)</span>
<span id="cb31-303"><a href="#cb31-303" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(combined_data)</span></code></pre></div>

</div>
</div>
<div id="δημιουργία-λίστα-παραμέτρων-προς-εκτέλεση." class="section level2 hasAnchor">
<h2>Δημιουργία λίστα παραμέτρων προς εκτέλεση.<a href="#δημιουργία-λίστα-παραμέτρων-προς-εκτέλεση." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Η λίστα παραμέτρων μίας παρτίδας εργασιών περιγράφει όλες τις συνθήκες με τις οποίες επιθυμούμε να γίνει η προσομοίωση της ακτινοβολίας στην ατμόσφαιρα.</p>
<p>Επιλέξαμε να δημιουργούμε αυτή τη λίστα σε δύο στάδια.
Στην αρχή, καθορίζονται οι συνθήκες για τις οποίες επιθυμούμε να τρέξουμε την libRadtran και από αυτές κατασκευάζουμε όλα τα ενδεχόμενα.
Στη συνέχεια, η λίστα των επιθυμητών ενδεχομένων συγκρίνεται με τα υπάρχοντα αποτελέσματα, ώστε να αποφευχθεί ο επαναυπολογισμός ήδη έτοιμων δεδομένων.
Το αποτέλεσμα είναι μία νέα παρτίδα εργασιών που μπορεί να κατατεθεί στο grid για επεξεργασία.</p>
<p>Με αυτόν τον τρόπο, μπορούμε να ξεκινήσουμε με αρκετά αραιές επιθυμητές συνθήκες, και στη συνέχεια να αυξήσουμε την πυκνότητά τους ανάλογα με τις παραμέτρους για τις οποίες ενδιαφερόμαστε.
Μοιράζοντας τον φόρτο εργασίας σε μικρότερα κομμάτια, έχοντας τη δυνατότητα να εκτιμήσουμε προοδευτικά τα αποτελέσματα που παίρνουμε από το μοντέλο και ελέγχοντας για την ύπαρξη προηγούμενων αποτελεσμάτων, μπορούμε να μειώσουμε τους άσκοπους υπολογισμούς.</p>
<p>Παρακάτω παραθέτουμε ένα script γραμμένο σε ’R’το οποίο προσπαθεί να δημιουργήσει έναν ορθογώνιο χώρο φάσεων. Εδώ, φαίνεται και ο τρόπος γραμμικοποίησης των παραμέτρων του <code>uvspec</code>. Δε θα περιγράψουμε τη λειτουργία του καθώς το ίδιο αποτέλεσμα μπορεί να επιτευχθεί με οποιαδήποτε γλώσσα προγραμματισμοί.</p>
<div id="αρχείο-lbt_job_list_creationpbs.r" class="section level4 hasAnchor">
<h4>Αρχείο <code>LBT_job_list_creationPBS.R</code><a href="#αρχείο-lbt_job_list_creationpbs.r" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p> </p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env Rscript</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="do">#### Clear environment</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="do">#### ------------------------------------</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">closeAllConnections</span>()</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> (<span class="fu">ls</span>()[<span class="fu">ls</span>() <span class="sc">!=</span> <span class="st">&quot;&quot;</span>]))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">TZ =</span> <span class="st">&quot;UTC&quot;</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>tic <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bitops)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="do">## folder for this model family</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="do">## setwd(&#39;/mnt/lapmg_a/.../LibRadTranM/clear_H2O_LAP&#39;)</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>datafile <span class="ot">&lt;-</span> <span class="st">&quot;../clear_H2O_LAP.Rds&quot;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>outfilelist <span class="ot">&lt;-</span> <span class="st">&quot;jobs_args.list&quot;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(datafile)) {</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;No previus results found&quot;</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="do">#### Options to create multiple jobs</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="do">#### ----------------------</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>wvlngth_min <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># wvlngth_max = 4000.0</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>wvlngth_max <span class="ot">&lt;-</span> <span class="dv">5025</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># spline_min = 250 spline_max = 4000 spline_stp = 1</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>altitude <span class="ot">&lt;-</span> <span class="fl">62.694168</span><span class="sc">/</span><span class="dv">1000</span>  <span class="do">## for LAP 62.694168/1000.</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>number_of_streams <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>rte_solver <span class="ot">&lt;-</span> <span class="st">&quot;sdisort&quot;</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>mol_modify_O3 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">290</span>, <span class="dv">370</span>, <span class="dv">10</span>)  <span class="do">## climatology or iterate</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>mol_modify_H2O <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">37</span>, <span class="dv">10</span>)  <span class="do">## MM : kg/m^2</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Min sza for thessaloniki ~17.20.  At sza=100</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="do">## something breaks !!!!</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>sza <span class="ot">&lt;-</span> <span class="fu">unique</span>(</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">95</span>, <span class="dv">10</span>),</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">seq</span>(<span class="dv">25</span>, <span class="dv">90</span>, <span class="dv">10</span>),</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>atmosphere_file <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;afglms&quot;</span>, <span class="st">&quot;afglmw&quot;</span>)</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>source_solar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;kurudz_1.0nm&quot;</span>, <span class="st">&quot;kurudz_0.1nm&quot;</span>, <span class="st">&quot;kurudz_full&quot;</span>)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>albedo <span class="ot">&lt;-</span> <span class="fu">unique</span>(</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">seq</span>(<span class="fl">0.05</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span>),</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.07</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a><span class="do">#### create combination of all options given</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="do">#### --------------</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>todolisting <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">wvlngth_min =</span> wvlngth_min, <span class="at">wvlngth_max =</span> wvlngth_max,</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">atmosphere_file =</span> atmosphere_file, <span class="at">source_solar =</span> source_solar,</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">rte_solver =</span> rte_solver, <span class="at">number_of_streams =</span> number_of_streams,</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">sza =</span> <span class="fu">unique</span>(sza),</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">mol_modify_O3 =</span> <span class="fu">unique</span>(mol_modify_O3),</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">mol_modify_H2O =</span> <span class="fu">unique</span>(mol_modify_H2O),</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">albedo =</span> <span class="fu">unique</span>(albedo),</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">altitude =</span> altitude, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>todolisting <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(todolisting, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>colanmes <span class="ot">&lt;-</span> <span class="fu">names</span>(todolisting)</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a><span class="do">#### load saved results</span></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>saved_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(datafile)</span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>saved_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(saved_results, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>saved_results<span class="sc">$</span>hostname <span class="ot">&lt;-</span> <span class="fu">as.character</span>(saved_results<span class="sc">$</span>hostname)</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a><span class="do">### Find jobs to do</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>temptodo <span class="ot">&lt;-</span> todolisting[, colanmes]  <span class="do">## will keep intact</span></span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>tempsaved <span class="ot">&lt;-</span> saved_results[, colanmes]  <span class="do">## used to compare</span></span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a><span class="do">## combine with index</span></span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>temptodo<span class="sc">$</span>coder <span class="ot">&lt;-</span> <span class="st">&quot;A&quot;</span></span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>tempsaved<span class="sc">$</span>coder <span class="ot">&lt;-</span> <span class="st">&quot;B&quot;</span></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tempsaved, temptodo)</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>uniqu <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">duplicated</span>(temp[, colanmes])</span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a><span class="do">## keep unique</span></span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[uniqu, ]</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a><span class="do">## dont include &#39;B&#39; (saved results)</span></span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[temp<span class="sc">$</span>coder <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, ]</span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a><span class="do">## drop coder column</span></span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>todolisting <span class="ot">&lt;-</span> <span class="fu">subset</span>(temp, <span class="at">select =</span> <span class="sc">-</span>coder)</span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(todolisting[, <span class="dv">1</span>]) <span class="sc">&lt;</span></span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>) <span class="fu">stop</span>(<span class="st">&quot;STOPED! No jobs to do&quot;</span>)</span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a><span class="do">## add job index to keep track</span></span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a>todolisting<span class="sc">$</span>job_id <span class="ot">&lt;-</span> <span class="fu">cksum</span>(<span class="fu">apply</span>(todolisting, <span class="dv">1</span>, paste, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a><span class="do">## creat file with list of jobs to submit serialize</span></span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;&quot;</span>, <span class="at">file =</span> outfilelist)</span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ri <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(todolisting)) {</span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>    OptVect <span class="ot">&lt;-</span> todolisting[ri, ]</span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(</span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;&quot;</span>),</span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;%s &quot;</span>, OptVect<span class="sc">$</span>job_id),</span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(</span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;atmosphere_file@@aattmmoo=%s.dat@&quot;</span>, OptVect<span class="sc">$</span>atmosphere_file</span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(</span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;source@@solar@@ssoollaa=%s.dat@&quot;</span>, OptVect<span class="sc">$</span>source_solar</span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;mol_modify@@O3@@%s@@DU@&quot;</span>, OptVect<span class="sc">$</span>mol_modify_O3),</span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;mol_modify@@H2O@@%s@@MM@&quot;</span>, OptVect<span class="sc">$</span>mol_modify_H2O),</span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;albedo@@%s@&quot;</span>, OptVect<span class="sc">$</span>albedo),</span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;sza@@%s@&quot;</span>, OptVect<span class="sc">$</span>sza),</span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;altitude@@%s@&quot;</span>, OptVect<span class="sc">$</span>altitude),</span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;rte_solver@@%s@&quot;</span>, OptVect<span class="sc">$</span>rte_solver),</span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;number_of_streams@@%s@&quot;</span>, OptVect<span class="sc">$</span>number_of_streams),</span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(</span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;wavelength@@%s@@%s@&quot;</span>, OptVect<span class="sc">$</span>wvlngth_min,</span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a>            OptVect<span class="sc">$</span>wvlngth_max</span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;pseudospherical@&quot;</span>),</span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;quiet@&quot;</span>),</span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>),</span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">&quot;&quot;</span>, <span class="at">file =</span> outfilelist, <span class="at">append =</span> <span class="cn">TRUE</span></span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(</span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(</span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Jobs to do: &quot;</span>, <span class="fu">nrow</span>(todolisting),</span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>

</div>
</div>
</div>
<div id="διαχείριση-αποτελεσμάτων." class="section level1 hasAnchor">
<h1>Διαχείριση αποτελεσμάτων.<a href="#διαχείριση-αποτελεσμάτων." class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Η αποθήκευση και χρήση των αποτελεσμάτων μπορεί να γίνει αρκετά δύσκολη μετά από κάποιο όγκο προσομοιώσεων. Όπως για παράδειγμα, όταν έχουμε να κάνουμε με διερεύνηση ατμοσφαιρικών συνθηκών, οπού πολύ εύκολα μπορούμε να φτάσουμε τα εκατομμύρια εκτελέσεων. Αυτό μπορεί να θέσει όρια λόγω της μνήμης του υπολογιστή, της πολυπλοκότητας αποθήκευση, του χρόνου αναζήτησης, του συστήματος αρχείων και άλλα. Για τον λόγο αυτό, προτείνεται η χρήση κάποιας βάσης δεδομένων του προτύπου SQL. Στην εφαρμογή μας χρησιμοποιήσαμε την βάση δεδομένων SQLite.</p>
<p>Επιγραμματικά αναφέρουμε κάποια οφέλη:</p>
<ul>
<li>Πρακτικά, απεριόριστη δυνατότητα αποθήκευσης σε ενιαίο αρχείο/πίνακα.</li>
<li>Ταχύτατη αναζήτηση και ανάσυρση δεδομένων.</li>
<li>Δυνατότητα απόρριψης διπλότυπων κατά την εισαγωγή δεδομένων.</li>
<li>Συμβατή με τις περισσότερες γλώσσες προγραμματισμού και υπολογιστικών συστημάτων.</li>
<li>Δυνατότητα αποθήκευση περιληπτικών αποτελεσμάτων και αντιστοίχηση με τα φασματικά.</li>
</ul>

<div style="page-break-after: always;"></div>
</div>
<div id="οδηγός-εγκατάστασης-της-libradtran-σε-περιβάλλον-windows." class="section level1 hasAnchor">
<h1>Οδηγός Εγκατάστασης της LibRadtran σε περιβάλλον Windows.<a href="#οδηγός-εγκατάστασης-της-libradtran-σε-περιβάλλον-windows." class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p><em>Αρχικός οδηγός από τον Κώστα Φράγκο, προσαρμογή από Θανάση Νάτση.</em></p>
</blockquote>
<p>Η LibRadtran είναι ένα πακέτο επίλυσης της εξίσωσης της διάδοσης της ακτινοβολίας μιας διάστασης (1D). Αποτελείται από ξεχωριστούς κώδικες γραμμένους σε γλώσσα ‘C’ ή/και ‘Fortran’. Πριν να είναι κάποιος σε θέση να χρησιμοποιήσει την LibRadtran θα πρέπει να “μεταγλωττίσει” και να “συνδέσει” (εγκατάσταση) τις ξεχωριστές ρουτίνες μεταξύ τους. Επειδή, το πακέτο είναι κατασκευασμένο να δουλεύει σε περιβάλλον Linux, για να το εγκαταστήσουμε σε περιβάλλον Windows απαιτούνται κάποιες επιπρόσθετες διαδικασίες, οι οποίες περιγράφονται βήμα-βήμα σε αυτόν τον οδηγό και περιγράφονται πιο συνοπτικά στις οδηγίες εγκατάστασης σε περιβάλλον Windows στη σελίδα της <a href="http://www.libradtran.org/doc/README.windows">LibRadtran</a>.</p>
<div id="εγκατάσταση-του-λειτουργικού-περιβάλλοντος-cygwin." class="section level2 hasAnchor">
<h2>Εγκατάσταση του λειτουργικού περιβάλλοντος ‘Cygwin’.<a href="#εγκατάσταση-του-λειτουργικού-περιβάλλοντος-cygwin." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Αρχικά εγκαθιστούμε τη σουίτα ‘Cygwin’, που μας επιτρέπει να εκτελούμε εντολές Linux. Κατά τη διάρκεια της εγκατάστασης του ‘Cygwin’ πρέπει να σιγουρευτούμε ότι έχουμε περιλάβει όλες τις απαραίτητες βιβλιοθήκες που απαιτούνται για την ομαλή εγκατάσταση της LibRadtran. Αυτές είναι οι ακόλουθες:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span>  binutils  cygwin  flex  gawk</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span>   gzip      make    tar</span></code></pre></div>
<p>Από την ιστοσελίδα του <a href="http://cygwin.com">Cygwin</a> κατεβάζουμε το <a href="http://cygwin.com/setup-x86.exe">πρόγραμμα εγκατάστασης του Cygwin</a>. <em><strong>Σημείωση</strong> ακόμα και αν έχουμε 64bit έκδοση λειτουργικού, καλό θα ήταν να εγκαταστήσουμε την 32bit έκδοση του ‘Cygwin’, για να αποφύγουμε στη συνέχεια κάποιες επιπλέον ρυθμίσεις</em>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:execdown"></span>
<img src="images/img-001-000.png" alt="Κατέβασμα και αποθήκευση του εκτελέσιμου προγράμματος εγκατάστασης του 'Cygwin'." width="75%" />
<p class="caption">
Σχήμα 1: Κατέβασμα και αποθήκευση του εκτελέσιμου προγράμματος εγκατάστασης του ‘Cygwin’.
</p>
</div>
<p>Αφού κατεβάσουμε το εκτελέσιμο (Εικόνα <a href="#fig:execdown">1</a>), πατάμε δεξί κλικ και επιλέγουμε ‘Run as Administrator’ (Εκτέλεση ως διαχειριστής) (Εικόνα <a href="#fig:runexec">2</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:runexec"></span>
<img src="images/img-002-001.png" alt="Εκτέλεση του προγράμματος εγκατάστασης του 'Cygwin'." width="75%" />
<p class="caption">
Σχήμα 2: Εκτέλεση του προγράμματος εγκατάστασης του ‘Cygwin’.
</p>
</div>
<p>Στις επόμενες επιλογές πατάμε ‘yes’ και ‘Next’, μέχρι να δούμε την Εικόνα <a href="#fig:execinst">3</a>, όπου θα επιλέξουμε να κάνουμε εγκατάσταση από το διαδίκτυο (install from internet) και στη συνέχεια την επιλογή ‘Next’.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:execinst"></span>
<img src="images/img-002-002.png" alt="Εγκατάσταση του Cygwin χρησιμοποιώντας το Internet." width="75%" />
<p class="caption">
Σχήμα 3: Εγκατάσταση του Cygwin χρησιμοποιώντας το Internet.
</p>
</div>
<p>Επιλέγουμε να αφήσουμε το default directory εγκατάστασης (<a href="#fig:instopts">4</a>) και συνεχίζουμε πατώντας ‘Next’. Είναι καλό ο φάκελος εγκατάστασης που θα επιλέξουμε να μην έχει κενά, να αποτελείται μόνο από λατινικούς χαρακτήρες και είναι δυνατόν να βρίσκεται στο <code>c:\</code> (root των Windows).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:instopts"></span>
<img src="images/img-003-003.png" alt="Επιλογή εγκατάστασης του Cygwin στο default directory." width="75%" />
<p class="caption">
Σχήμα 4: Επιλογή εγκατάστασης του Cygwin στο default directory.
</p>
</div>
<p>Προσπερνάμε την επόμενη σελίδα που θα μας βγάλει, πατώντας ‘Next’ και στη συνέχεια επιλέγουμε τον τύπο σύνδεσής μας στο Internet (συνήθως είναι direct connection) και επιλέγουμε το ‘Next’ (Εικόνα <a href="#fig:optscone">5</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:optscone"></span>
<img src="images/img-004-004.png" alt="Επιλογή σύνδεσης στο Internet." width="75%" />
<p class="caption">
Σχήμα 5: Επιλογή σύνδεσης στο Internet.
</p>
</div>
<p>Στην επόμενη καρτέλα διαλέγουμε από που θέλουμε να κατεβάσουμε τα πακέτα που είναι απαραίτητα για την εγκατάσταση του ‘Cygwin’. Κάνοντας scroll down με το ποντίκι μπορούμε να βρούμε κάποια τοποθεσία στην Ελλάδα (π.χ. στην Εικόνα <a href="#fig:netloc">6</a> έχει γίνει επιλογή του ftp του Μετσόβιου Πολυτεχνείου. Κάποιος μπορεί να επιλέξει οποιαδήποτε τοποθεσία θέλει, επιλέγοντας κάποια τοποθεσία στην Ελλάδα ελαχιστοποιεί το χρόνο που χρειάζεται για να κατέβουν τα πακέτα εγκατάστασης).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:netloc"></span>
<img src="images/img-005-005.png" alt="Επιλογή τοποθεσίας για το κατέβασμα του 'Cygwin'." width="75%" />
<p class="caption">
Σχήμα 6: Επιλογή τοποθεσίας για το κατέβασμα του ‘Cygwin’.
</p>
</div>
<p>Στην επόμενη σελίδα θα διαλέξουμε τα πακέτα που χρειάζονται για την εγκατάσταση της LibRadtran τα όποια όπως είδαμε πιο πάνω είναι: <code>bash, binutils, cygwin, flex, gawk, gcc, gzip, make, tar</code>. Στο πλαίσιο που έχει για αναζήτηση (Εικόνα <a href="#fig:setpack">7</a>) τοποθετούμε καθένα πακέτο ξεχωριστά και κάνουμε αναζήτηση για να δούμε αν είναι προεγκατεστημένο ή χρειάζεται να το επιλέξουμε εμείς. Συνήθως, τα πακέτα βρίσκονται στις κατηγορίες ‘Base’, ‘Devel’ και ‘Utils’.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setpack"></span>
<img src="images/img-005-006.png" alt="Αναζήτηση των πακέτων που είναι απαραίτητα να εγκατασταθούν." width="75%" />
<p class="caption">
Σχήμα 7: Αναζήτηση των πακέτων που είναι απαραίτητα να εγκατασταθούν.
</p>
</div>
<p>Ξεκινούμε αναζητώντας το πακέτο <code>bash</code> (Εικόνα <a href="#fig:setbash">8</a>) όπου παρατηρούμε ότι είναι ήδη στα πακέτα που γίνονται εγκατάσταση.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setbash"></span>
<img src="images/img-006-007.png" alt="Αναζήτηση του πακέτου `bash`, παρατηρούμε ότι είναι προεγκατεστημένα πακέτα του Cygwin." width="75%" />
<p class="caption">
Σχήμα 8: Αναζήτηση του πακέτου <code>bash</code>, παρατηρούμε ότι είναι προεγκατεστημένα πακέτα του Cygwin.
</p>
</div>
<p>Στη συνέχεια αναζητούμε το <code>binutils</code>, το οποίο είναι στο ‘Devel’ (Εικόνα <a href="#fig:setbinut">9</a>) παρατηρούμε ότι έχει την επιλογή <code>Skip</code>, πατώντας μια φορά με το ποντίκι πάνω στο ‘Skip’, αλλάζουμε την κατάσταση ώστε να εγκατασταθεί, όπως φαίνεται στην Εικόνα <a href="#fig:setbinutB">10</a>. Την ίδια διαδικασία ακολουθούμε και για όλα τα υπόλοιπα πακέτα που παρατηρούμε ότι δεν περιέχονται από default (όπως το <code>bash</code>) στην εγκατάσταση του ‘Cygwin’.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setbinut"></span>
<img src="images/img-007-008.png" alt="Αναζήτηση της επιλογής `binutils`." width="75%" />
<p class="caption">
Σχήμα 9: Αναζήτηση της επιλογής <code>binutils</code>.
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setbinutB"></span>
<img src="images/img-008-009.png" alt="Επιλογή εγκατάστασης του `binutils`." width="75%" />
<p class="caption">
Σχήμα 10: Επιλογή εγκατάστασης του <code>binutils</code>.
</p>
</div>
<p>Εν συνεχεία αναζητούμε το ‘Cygwin’, το οποίο όπως παρατηρούμε στην Εικόνα <a href="#fig:setcygw">11</a>, εγκαθίσταται ως default επιλογή.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setcygw"></span>
<img src="images/img-009-010.png" alt="Αναζήτηση του 'Cygwin', δε χρειάζεται κάποια μεταβολή." width="75%" />
<p class="caption">
Σχήμα 11: Αναζήτηση του ‘Cygwin’, δε χρειάζεται κάποια μεταβολή.
</p>
</div>
<p>Το πακέτο <code>flex</code> δεν περιέχεται στα default πακέτα εγκατάστασης, οπότε κάνουμε ότι για το πακέτο <code>binutils</code>, έτσι ώστε να δούμε την Εικόνα <a href="#fig:setflex">12</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setflex"></span>
<img src="images/img-010-011.png" alt="Επιλογή εγκατάστασης του πακέτου `flex`." width="75%" />
<p class="caption">
Σχήμα 12: Επιλογή εγκατάστασης του πακέτου <code>flex</code>.
</p>
</div>
<p>Το πακέτο <code>gawk</code>, βρίσκεται ανάμεσα σε αυτά που εγκαθίστανται από default (Εικόνα <a href="#fig:setgawk">13</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setgawk"></span>
<img src="images/img-011-012.png" alt="Αναζήτηση του πακέτου `gawk`." width="75%" />
<p class="caption">
Σχήμα 13: Αναζήτηση του πακέτου <code>gawk</code>.
</p>
</div>
<p>Ο <code>gcc</code> είναι ο compiler που μεταγλωττίζει κώδικα γλώσσας ‘C’ και ‘Fortran’. Επιλέγετε για εγκατάσταση αυτούς που φαίνονται στην Εικόνα <a href="#fig:setgcc">14</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setgcc"></span>
<img src="images/img-012-013.png" alt="Εγκατάσταση του compilers `gcc` για μεταγλώττιση του κώδικα C και Fortran." width="75%" />
<p class="caption">
Σχήμα 14: Εγκατάσταση του compilers <code>gcc</code> για μεταγλώττιση του κώδικα C και Fortran.
</p>
</div>
<p>To <code>gzip</code> είναι από τα default πακέτα του ‘Cygwin’ (Εικόνα <a href="#fig:setgzip">15</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setgzip"></span>
<img src="images/img-013-014.png" alt="Αναζήτηση του πακέτου `gzip`." width="75%" />
<p class="caption">
Σχήμα 15: Αναζήτηση του πακέτου <code>gzip</code>.
</p>
</div>
<p>To <code>make</code> δεν είναι στα default οπότε χρειάζεται να αλλάξουμε την κατάστασή του για να εγκατασταθεί (Εικόνα <a href="#fig:setmake">16</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setmake"></span>
<img src="images/img-014-015.png" alt="Εγκατάσταση του πακέτου `make`." width="75%" />
<p class="caption">
Σχήμα 16: Εγκατάσταση του πακέτου <code>make</code>.
</p>
</div>
<p>To <code>tar</code> εγκαθίσταται από default (Εικόνα <a href="#fig:settar">17</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:settar"></span>
<img src="images/img-015-016.png" alt="Αναζήτηση του πακέτου `tar`." width="75%" />
<p class="caption">
Σχήμα 17: Αναζήτηση του πακέτου <code>tar</code>.
</p>
</div>
<p>Τέλος, εκτός από τα παραπάνω που είναι απαραίτητα για την εγκατάσταση της LibRadtran, καλό θα ήταν να εγκαταστήσουμε μαζί με το ‘Cygwin’ και τη γλώσσα ‘Perl’, αλλάζοντας το status από default σε install (Εικόνα <a href="#fig:setperl">18</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:setperl"></span>
<img src="images/img-016-017.png" alt="Εγκατάσταση της γλώσσας 'Perl' σε περιβάλλον 'Cygwin'." width="75%" />
<p class="caption">
Σχήμα 18: Εγκατάσταση της γλώσσας ‘Perl’ σε περιβάλλον ‘Cygwin’.
</p>
</div>
<p>Αφού ολοκληρώσουμε τον έλεγχο για τα πακέτα που θέλουμε να εγκαταστήσουμε πατάμε ‘Next’, όπου μετά θα δούμε όλα τα πακέτα που εγκαθίστανται και πατάμε ‘Next’, οπότε ξεκινάει το κατέβασμα και η εγκατάσταση του ‘Cygwin’ και των πακέτων που επιλέξαμε (Εικόνα <a href="#fig:instcygw">19</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:instcygw"></span>
<img src="images/img-017-018.png" alt="Εγκατάσταση του 'Cygwin'." width="75%" />
<p class="caption">
Σχήμα 19: Εγκατάσταση του ‘Cygwin’.
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:instend"></span>
<img src="images/img-017-019.png" alt="Ολοκλήρωση εγκατάστασης του 'Cygwin'." width="75%" />
<p class="caption">
Σχήμα 20: Ολοκλήρωση εγκατάστασης του ‘Cygwin’.
</p>
</div>
</div>
<div id="εγκατάσταση-της-libradtran." class="section level2 hasAnchor">
<h2>Εγκατάσταση της LibRadtran.<a href="#εγκατάσταση-της-libradtran." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Κατεβάζουμε την LibRadtran από το <a href="http://www.libradtran.org/doku.php?id=download">site</a>. Παλιότερες εκδόσεις της LibRadtran μπορούν να βρεθούν <a href="http://www.libradtran.org/download/history/">εδώ</a>.</p>
<p>Αφού ολοκληρωθεί η λήψη του αρχείου, το τοποθετούμε στο φάκελο <code>c:\cygwin\home</code> (Εικόνα <a href="#fig:libloc">21</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:libloc"></span>
<img src="images/img-018-020.png" alt="Κατάλογος στον οποίο θα γίνει η εγκατάσταση της LibRadtran." width="75%" />
<p class="caption">
Σχήμα 21: Κατάλογος στον οποίο θα γίνει η εγκατάσταση της LibRadtran.
</p>
</div>
<p>Ανοίγουμε το τερματικό του ‘Cygwin’ από την επιφάνεια εργασίας, εκτελούμε την εντολή <code>cd ..</code> για να βρεθούμε στο ‘home’ και στη συνέχεια την εντολή <code>ls</code> για να σιγουρευτούμε ότι έχουμε το πακέτο της libRadtran στον κατάλογο που βρισκόμαστε (Εικόνα <a href="#fig:wdloc">22</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:wdloc"></span>
<img src="images/img-018-021.jpg" alt="Κατάλογος εργασίας στο περιβάλλον 'Cygwin'." width="75%" />
<p class="caption">
Σχήμα 22: Κατάλογος εργασίας στο περιβάλλον ‘Cygwin’.
</p>
</div>
<p>Αφού σιγουρευτούμε ότι έχουμε το πακέτο της LibRadtran στον φάκελο που βρισκόμαστε εκτελούμε τις ακόλουθες εντολές, για την αποσυμπίεση των αρχείων.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gzip</span> <span class="at">-d</span>   libRadtran-1.7.tar.gz</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span>  <span class="at">-xvf</span> libRadtran-1.7.tar</span></code></pre></div>
<p>Στην συνέχεια, με την εντολή <code>ls</code> επαληθεύουμε ότι έχει δημιουργηθεί ένας νέος φάκελος (Εικόνα <a href="#fig:libunzip">23</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:libunzip"></span>
<img src="images/img-019-022.png" alt="Αποσυμπίεση του αρχείου Libradtran.tar." width="75%" />
<p class="caption">
Σχήμα 23: Αποσυμπίεση του αρχείου Libradtran.tar.
</p>
</div>
<p>Γράφουμε <code>cd libRadtran-1.7</code>, για να μεταφερθούμε στον φάκελο της Libradtran, με <code>ls</code> μπορούμε να δούμε τα περιεχόμενα του φακέλου και στη συνέχεια γράφουμε την ακόλουθη εντολή, για να επιλέξουμε τον compiler για την μεταγλώττιση του κώδικα ‘Fortran’ (Εικόνα <a href="#fig:libfort">24</a>).</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">F77</span><span class="op">=</span>gfortran</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:libfort"></span>
<img src="images/img-020-023.png" alt="Επιλογή του compiler για την αποσφαλμάτωση του κώδικα Fortran." width="75%" />
<p class="caption">
Σχήμα 24: Επιλογή του compiler για την αποσφαλμάτωση του κώδικα Fortran.
</p>
</div>
<p>Τώρα εκτελούμε την εντολή <code>./configure</code>. Στο τέλος, θα πρέπει να δούμε στην οθόνη του τερματικού τα ακόλουθα όπως φαίνεται στην Εικόνα <a href="#fig:libconf">25</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:libconf"></span>
<img src="images/img-020-024.png" alt="Ολοκλήρωση της διαδικασίας configure." width="75%" />
<p class="caption">
Σχήμα 25: Ολοκλήρωση της διαδικασίας configure.
</p>
</div>
<p>Η εγκατάσταση (compile) τώρα μπορεί να ολοκληρωθεί εκτελώντας την εντολή <code>make</code> και για σιγουρευτούμε ότι όλα είναι εντάξει κατά τη διάρκεια της εγκατάστασης, αφού τελειώσει η εντολή <code>make</code>, εκτελούμε την εντολή <code>make check</code>, όπου θα δούμε στην οθόνη του τερματικού μας μια σειρά από test, όπως στην Εικόνα <a href="#fig:mkcheck">26</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mkcheck"></span>
<img src="images/img-021-025.png" alt="Έλεγχος της ορθής εγκατάστασης της Libradtran." width="75%" />
<p class="caption">
Σχήμα 26: Έλεγχος της ορθής εγκατάστασης της Libradtran.
</p>
</div>
<p>Εάν όλα έχουν ολοκληρωθεί επιτυχώς, στον φάκελο <code>libRadtran-1.7/bin</code> υπάρχουν μια σειρά από εκτελέσιμα αρχεία. Για την χρήση τους μπορείτε να ανατρέξετε στο manual της libRadtran ή στα αντίστοιχα αρχεία του πηγαίου κώδικα (source code) που πολλές φορές, μπορεί να είναι πολύ πιο κατατοπιστικά για τη λειτουργία που εκτελούν. Το κύριο εκτελέσιμο αρχείο του μοντέλου είναι το <code>uvspec</code>.</p>

<div style="page-break-after: always;"></div>
</div>
</div>
<div id="χρήσιμες-πληροφορίες-για-τη-χρήση-της-libradtran." class="section level1 hasAnchor">
<h1>Χρήσιμες πληροφορίες για τη χρήση της libRadtran.<a href="#χρήσιμες-πληροφορίες-για-τη-χρήση-της-libradtran." class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="μονάδες-μέτρησης-ηλιακού-φάσματος." class="section level2 hasAnchor">
<h2>Μονάδες μέτρησης ηλιακού φάσματος.<a href="#μονάδες-μέτρησης-ηλιακού-φάσματος." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Οι μονάδες μέτρησης των αποτελεσμάτων είναι ίδιες με του παραμετρικού αρχείου εισόδου του ηλιακού φάσματος. Για παράδειγμα, για το αρχείο ‘kurudz_0.1nm.dat’ αναφέρεται ότι:</p>
<blockquote>
<p>The original Kurudz [1992] data were converted to <span class="math inline">\(mW / (m^2 nm)\)</span> and averaged over <span class="math inline">\(0.1nm\)</span> intervals centered around the given wavelength.</p>
</blockquote>
</div>
<div id="φασματικοί-υπολογισμοί-spectral-resolution." class="section level2 hasAnchor">
<h2>Φασματικοί υπολογισμοί (spectral resolution).<a href="#φασματικοί-υπολογισμοί-spectral-resolution." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Το βήμα των φασματικών υπολογισμών είναι προκαθορισμένο εσωτερικά. Για την αλλαγή του spectral resolution πρέπει να καθοριστεί μέσω της παραμέτρου <code>wavelength_grid_file</code>.</p>
</div>
<div id="έξοδος-του-uvspec." class="section level2 hasAnchor">
<h2>Έξοδος του uvspec.<a href="#έξοδος-του-uvspec." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Η τυπική διαμόρφωση (default output format) της εξόδου του <code>uvspec</code> είναι:</p>
<pre><code>lambda edir edn eup uavgdir uavgdn uavgup</code></pre>
<p>Οι μεταβλητές εξόδου που μπορούν να δοθούν από το <code>uvspec</code>, ανάλογα με τα στοιχεία εισόδου, περιγράφονται παρακάτω.</p>
<dl>
<dt>cmu</dt>
<dd>
Computational polar angles from polradtran.
</dd>
<dt>down_flux, up_flux</dt>
<dd>
The total (direct+diffuse) downward (down_flux) and up-ward(up_flux)
irradiances. Same units as extraterrestrial irradiance ( e.g <span class="math inline">\(mW/(m^2 nm)\)</span>
if using the atlas3 spectrum in the data/solar_flux directory.)
</dd>
<dt>edir</dt>
<dd>
Direct beam irradiance w.r.t. horizontal plane (same unit as extraterrestrial
irradiance).
</dd>
<dt>edn</dt>
<dd>
Diffuse down irradiance, i.e. total minus direct beam (same unit as edir).
</dd>
<dt>eup</dt>
<dd>
Diffuse up irradiance (same unit as edir).
</dd>
<dt>lambda</dt>
<dd>
Wavelength (<span class="math inline">\(nm\)</span>)
</dd>
<dt>u0u</dt>
<dd>
The azimuthally averaged intensity at numu user specified
angles umu (units of e.g. <span class="math inline">\(mW/(m^2 nm sr)\)</span> if using the atlas3
spectrum in the data/solar_flux directory.) Note that the intensity
correction included in the disort solver is not applied to u0u,
thus u0u can deviate from the azimuthally-averaged intensity-corrected uu.
</dd>
<dt>uavg</dt>
<dd>
The mean intensity. Proportional to the actinic flux: To
obtain the actinic flux, multiply the mean intensity by <span class="math inline">\(4\pi\)</span>
(same unit as edir).
</dd>
<dt>uavgdir</dt>
<dd>
Direct beam contribution to the mean intensity (same unit as edir).
</dd>
<dt>uavgdn</dt>
<dd>
Diffuse downward radiation contribution to the mean intensity (same unit as edir).
</dd>
<dt>uavgup</dt>
<dd>
Diffuse upward radiation contribution to the mean intensity (same unit as edir).
</dd>
<dt>uu</dt>
<dd>
The radiance (intensity) at umu and phi user specified angles
(unit e.g. <span class="math inline">\(mW/(m^2 nm sr)\)</span> if using the atlas3 spectrum in
the data/solar_flux directory.)
</dd>
<dt>uu_down, uu_up</dt>
<dd>
The downwelling and upwelling radiances (intensity) at cmu
and phi angles (unit e.g. <span class="math inline">\(mW/(m^2 nm sr)\)</span> if using the
atlas3 spectrum in the data/solar_flux directory.)
</dd>
</dl>
</div>
<div id="τυπικά-ατμοσφαιρικά-προφίλ." class="section level2 hasAnchor">
<h2>Τυπικά ατμοσφαιρικά προφίλ.<a href="#τυπικά-ατμοσφαιρικά-προφίλ." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Στον Πίνακα <a href="#tab:atmoprof">1</a> παραθέτουμε στοιχεία από το <em>‘AFGL Atmospheric Constituent Profiles’</em> <span class="citation">(<a href="#ref-anderson1986afgl" role="doc-biblioref">Anderson et al. 1986</a>)</span>.</p>
<table>
<caption><span id="tab:atmoprof">Πίνακας 1: </span> Παράμετροι πρότυπων ατμοσφαιρικών προφίλ.</caption>
<thead>
<tr class="header">
<th align="center">Model</th>
<th align="left">Name</th>
<th align="center">Lat</th>
<th align="left">Time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="left">Tropic</td>
<td align="center">15N</td>
<td align="left">Annual Average</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="left">Mid-Latitude Summer</td>
<td align="center">45N</td>
<td align="left">July</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="left">Mid-Latitude Winter</td>
<td align="center">45N</td>
<td align="left">January</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="left">Sub Arctic Summer</td>
<td align="center">60N</td>
<td align="left">July</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="left">Sub Arctic Winter</td>
<td align="center">60N</td>
<td align="left">January</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="left">U.S. Standard</td>
<td align="center"></td>
<td align="left">1976</td>
</tr>
</tbody>
</table>
</div>
<div id="προειδοποίηση-για-τη-γωνία-sza43.2circ." class="section level2 hasAnchor">
<h2>Προειδοποίηση για τη γωνία <span class="math inline">\({SZA}=43.2^\circ\)</span>.<a href="#προειδοποίηση-για-τη-γωνία-sza43.2circ." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>H ζενίθια γωνία των <span class="math inline">\(43.2^\circ\)</span> προκαλεί μία προειδοποίηση (warning).
Το οποίο σχετίζεται με την δυνατότητα υπολογισμού τριγωνομετρικών συναρτήσεων
μικρών γωνιών.</p>
<pre><code>* * * * * * * WARNING &gt; &gt; &gt; &gt; &gt; &gt;
 SETDIS--beam angle=computational angle;
* * * * * * * changing cosine of solar zenith angle, umu0, from  0.728969 to 0.728928</code></pre>

<!-- \newpage -->
<!--  -->
<!-- # (APPENDIX) Appendix {-} -->
<!-- # Παράρτημα -->

</div>
</div>
<div id="αναφορές" class="section level1 unnumbered hasAnchor">
<h1>Αναφορές<a href="#αναφορές" class="anchor-section" aria-label="Anchor link to header"></a></h1>

<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-anderson1986afgl" class="csl-entry">
Anderson, G, S Clough, F Kneizys, J Chetwynd, and E Shettle. 1986. <span>“<span>AFGL</span> <span>A</span>tmospheric <span>C</span>onstituent <span>P</span>rofiles (0-120km).”</span> AFGL-TR-86-0110. <span>A</span>ir <span>F</span>orce <span>G</span>eophysics <span>L</span>aboratory, <span>H</span>anscom <span>A</span>ir <span>F</span>orce <span>B</span>ase, <span>B</span>edford, <span>MA</span>.
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Libratran_guide.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"number_sections": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
